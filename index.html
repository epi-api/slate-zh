
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>epiapi Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">
  </head>

  <body class="index" data-languages="[&quot;java&quot;,&quot;ruby&quot;,&quot;python&quot;,&quot;php&quot;,&quot;csharp&quot;,&quot;cURL&quot;,&quot;json&quot;]">
    <div class="mobile-nav">
        <a href="#" id="nav-button">
            <span>
                <!--NAV-->
                <img src="images/navbar.png" alt="Navbar" />
            </span>
        </a>
    </div>
    <div class="toc-wrapper">
      <img src="images/EPIAPIDocsLogo.svg" class="logo" alt="Epiapidocslogo" />
        <div class="lang-selector">
              <a href="#" data-language-name="java">java</a>
              <a href="#" data-language-name="ruby">ruby</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="php">php</a>
              <a href="#" data-language-name="csharp">csharp</a>
              <a href="#" data-language-name="cURL">cURL</a>
              <a href="#" data-language-name="json">json</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#153042ed9e" class="toc-h1 toc-link" data-title="">概述</a>
          </li>
          <li>
            <a href="#053c86ca0d" class="toc-h1 toc-link" data-title="">开始之前</a>
          </li>
          <li>
            <a href="#153042ed9e-2" class="toc-h1 toc-link" data-title="">概述</a>
              <ul class="toc-list-h2">
                  <li>

                    <a href="#bc79441a2e" class="toc-h2 toc-link" data-title="">支持国家（持续更新）</a>
                  </li>
                  <li>

                    <a href="#4d150364fe" class="toc-h2 toc-link" data-title="">请求方法</a>
                  </li>
                  <li>

                    <a href="#0504326819" class="toc-h2 toc-link" data-title="">生产/测试环境下的终端节点</a>
                  </li>
                  <li>

                    <a href="#95abacbcb6" class="toc-h2 toc-link" data-title="">分页机制</a>
                  </li>
                  <li>

                    <a href="#22f19e7e2c" class="toc-h2 toc-link" data-title="">验签</a>
                  </li>
                  <li>

                    <a href="#1028ed81a3" class="toc-h2 toc-link" data-title="">计算签名</a>
                  </li>
                  <li>

                    <a href="#f43db85ea6" class="toc-h2 toc-link" data-title="">资源名称</a>
                  </li>
                  <li>

                    <a href="#9836a95e9d" class="toc-h2 toc-link" data-title="">费用</a>
                  </li>
                  <li>

                    <a href="#128e9ff023" class="toc-h2 toc-link" data-title="">错误处理</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#1d33fae982" class="toc-h1 toc-link" data-title="">操作指南</a>
              <ul class="toc-list-h2">
                  <li>

                    <a href="#a573be9f55" class="toc-h2 toc-link" data-title="">虚拟银行</a>
                  </li>
  <ul class="toc-list-h3">
      <li>
        <a href="#1-kyc" class="toc-h3 toc-link" data-title="操作指南">1.使用KYC数据创建子钱包</a>
      </li>
      <li>
        <a href="#2-kyc" class="toc-h3 toc-link" data-title="操作指南">2.上传KYC文件</a>
      </li>
      <li>
        <a href="#3-kyc" class="toc-h3 toc-link" data-title="操作指南">3. 填入KYC数据</a>
      </li>
      <li>
        <a href="#4" class="toc-h3 toc-link" data-title="操作指南">4. 查询银行信息</a>
      </li>
      <li>
        <a href="#5" class="toc-h3 toc-link" data-title="操作指南">5.接收款项与回调</a>
      </li>
      <li>
        <a href="#6" class="toc-h3 toc-link" data-title="操作指南">6. 将美元从子钱包转至母账户</a>
      </li>
  </ul>
              </ul>
          </li>
          <li>
            <a href="#c3d92b20c8" class="toc-h1 toc-link" data-title="">账户</a>
              <ul class="toc-list-h2">
                  <li>

                    <a href="#bd9157656f" class="toc-h2 toc-link" data-title="">账户信息</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#88f0e7b5b9" class="toc-h1 toc-link" data-title="">子钱包</a>
              <ul class="toc-list-h2">
                  <li>

                    <a href="#5aea6fa68a" class="toc-h2 toc-link" data-title="">创建子钱包</a>
                  </li>
                  <li>

                    <a href="#ca23b97e7e" class="toc-h2 toc-link" data-title="">创建多个子钱包</a>
                  </li>
                  <li>

                    <a href="#0b81bd026f" class="toc-h2 toc-link" data-title="">查询子钱包</a>
                  </li>
                  <li>

                    <a href="#2436cc0e95" class="toc-h2 toc-link" data-title="">编辑钱包</a>
                  </li>
                  <li>

                    <a href="#f3cd4d2aa7" class="toc-h2 toc-link" data-title="">删除钱包</a>
                  </li>
                  <li>

                    <a href="#cc1fa66341" class="toc-h2 toc-link" data-title="">列出子钱包</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#8e9ec9ac7d" class="toc-h1 toc-link" data-title="">转账</a>
              <ul class="toc-list-h2">
                  <li>

                    <a href="#45fa4e00db" class="toc-h2 toc-link" data-title="">介绍</a>
                  </li>
                  <li>

                    <a href="#f84e5af910" class="toc-h2 toc-link" data-title="">创建转账</a>
                  </li>
                  <li>

                    <a href="#256bf99b14" class="toc-h2 toc-link" data-title="">确认转账</a>
                  </li>
                  <li>

                    <a href="#4c4e13bb92" class="toc-h2 toc-link" data-title="">查询转账</a>
                  </li>
                  <li>

                    <a href="#1a3ddc077b" class="toc-h2 toc-link" data-title="">转账状态</a>
                  </li>
                  <li>

                    <a href="#c76b97433d" class="toc-h2 toc-link" data-title="">回调</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#d76738d4d9" class="toc-h1 toc-link" data-title="">收款方式</a>
              <ul class="toc-list-h2">
                  <li>

                    <a href="#099c6945dc" class="toc-h2 toc-link" data-title="">添加银行信息</a>
                  </li>
                  <li>

                    <a href="#40011f3c91" class="toc-h2 toc-link" data-title="">查询收款方式</a>
                  </li>
                  <li>

                    <a href="#f285eee79f" class="toc-h2 toc-link" data-title="">美元付款</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://www.epiapi.com'>Visit us!</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='153042ed9e'>概述</h1>
<p>epiapi是一家专注于企业级即插即用跨境金融服务产品的科技公司，在母公司Wyre的平台基础上，epiapi开发的REST API产品，可以为全球客户提供方便快捷的虚拟银行服务。</p>

<p>我们的api使用HTTPS建立交互，JSON返回错误请求。为了更好地帮助您探索API产品，我们在生产环境之外额外设置了测试环境，任何在测试环境下的转账请求均不会被执行。测试及生产环境下，皆需要api key进行验签。</p>
<h1 id='053c86ca0d'>开始之前</h1>
<p>此api标准执行手册乃针对在美国亚马逊平台使用虚拟银行服务进行收款的api产品。按照指引，开发者在通过必要的KYC信息收集后，可以通过api执行创建虚拟银行账户，接收银行账号信息，监测入账，申请提现到国内银行账户等操作。在开始之前，请确保您已就此项业务合作与epiapi公司签署纸质协议，如若未签署协议或有其他问题，请通过 <a href="mailto:contact@epiapi.com">contact@epiapi.com</a>联系我们。</p>

<p>Check the <a href="http://docs.epiapi.com/">English Version</a>.</p>

<p><strong>开始</strong></p>

<p><strong>1.阅读此文档</strong></p>

<p>如果看到这里，恭喜您已经完成第一步，（记得看完）。</p>

<p><strong>2.注册测试用账户</strong></p>

<p>点击<a href="https://www.testwyre.com">这里</a>注册一个在测试环境下的账户。测试环境下无需上传任何文件。</p>

<p><strong>3.验证你的账户</strong></p>

<p>通过<a href="mailto:support@epiapi.com">support@epiapi.com</a>联系我们，我们可以为您验证测试账户并添加测试用款项。</p>

<p><strong>4.寻求帮助</strong></p>

<p>在账户验证通过后，我们将发送给您Slack或其他聊天工具(如钉钉、QQ）的加入邀请链接，方便您随时联系我们。</p>

<p><strong>5.注册生产环境账户</strong></p>

<p>在所有测试通过后，您可以点击<a href="https://www.sendwyre.com">这里</a>创建一个真实账户。生产环境下，您必须填写真实信息并上传需要的文件才能通过账户验证。</p>

<p><strong>6.上线！</strong></p>

<p>完成所有步骤，可以上线啦！</p>
<h1 id='153042ed9e-2'>概述</h1><h2 id='bc79441a2e'>支持国家（持续更新）</h2>
<p>我们的虚拟银行服务目前支持通过ACH接收美元到美国银行账户。</p>

<p><strong>国家</strong></p>

<ul>
<li>美国</li>
<li>欧洲（即将上线）</li>
<li>澳大利亚（即将上线）</li>
</ul>

<p>epiapi一直积极地在全球开展业务，如有更新，我们将以邮件形式通知您。</p>

<p><strong>货币</strong></p>

<ul>
<li>美元USD</li>
<li>欧元EUR（即将上线）</li>
<li>英镑GBP（即将上线）</li>
<li>澳元AUD（即将上线）</li>
</ul>
<h2 id='4d150364fe'>请求方法</h2>
<p>我们提供REST风格的api，以JSON响应。</p>

<p>调试时请留意，若您收到的异常响应不是以上格式，请检查您使用的服务器。</p>
<pre class="highlight json tab-json"><code><span class="err">For</span><span class="w"> </span><span class="err">successful</span><span class="w"> </span><span class="err">API</span><span class="w"> </span><span class="err">calls</span><span class="p">:</span><span class="w">
</span><span class="err">&lt;!--成功的API请求示例如下--&gt;：</span><span class="w">

</span><span class="p">{</span><span class="w">
        </span><span class="s2">"parameter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"parameter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABCDEF"</span><span class="w">

</span><span class="p">}</span><span class="w">

</span><span class="err">For</span><span class="w"> </span><span class="err">unsuccessful</span><span class="w"> </span><span class="err">API</span><span class="w"> </span><span class="err">calls</span><span class="p">:</span><span class="w">
</span><span class="err">&lt;!--失败的API请求示例如下--&gt;：</span><span class="w">
</span><span class="p">{</span><span class="w">
        </span><span class="s2">"language"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"exceptionId"</span><span class="p">:</span><span class="s2">"ABCDEF"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"compositeType"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"subType"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Error Message"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"ErrorTypeException"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"transient"</span><span class="p">:</span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='0504326819'>生产/测试环境下的终端节点</h2>
<p>我们使用生产、测试两种环境，<code>testwyre</code>用于测试环境，<code>sendwyre</code>用于生产环境。</p>

<table><thead>
<tr>
<th>环境</th>
<th>终端节点</th>
</tr>
</thead><tbody>
<tr>
<td>测试</td>
<td><a href="https://api.testwyre.com"> https://api.testwyre.com </a></td>
</tr>
<tr>
<td>生产</td>
<td><a href="https://api.sendwyre.com"> https://api.sendwyre.com </a></td>
</tr>
</tbody></table>
<h2 id='95abacbcb6'>分页机制</h2>
<p>我们将返回数设定为25项/页，在任何请求中， 您都可以通过使用下面的参数进行调整。</p>

<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>offset</td>
<td>返回记录开始位置 (默认: 0).</td>
</tr>
<tr>
<td>limit</td>
<td>每页返回记录数量 (默认: 25).</td>
</tr>
<tr>
<td>from</td>
<td>查询范围内首条记录的创建时间，UNIX毫秒单位。（默认：0）</td>
</tr>
<tr>
<td>to</td>
<td>查询范围内首条记录的创建时间，UNIX毫秒单位。（默认：现在时间）</td>
</tr>
</tbody></table>
<h2 id='22f19e7e2c'>验签</h2><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'uri'</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="nb">require</span> <span class="s1">'digest/hmac'</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="k">class</span> <span class="nc">WyreApi</span>
  <span class="nc">ACCOUNT_ID</span> <span class="o">=</span> <span class="s1">'YOUR_ACCOUNT_ID_HERE'</span>
  <span class="no">API_KEY</span> <span class="o">=</span> <span class="s1">'YOUR_API_KEY_HERE'</span>
  <span class="no">SEC_KEY</span> <span class="o">=</span> <span class="s1">'YOUR_SECRET_KEY_HERE'</span>
  <span class="no">API_URL</span> <span class="o">=</span> <span class="s1">'https://api.testwyre.com'</span>

  <span class="k">def</span> <span class="nf">create_transfer</span> <span class="n">options</span>
    <span class="n">api_post</span> <span class="s1">'/transfers'</span><span class="p">,</span> <span class="n">options</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">api_post</span> <span class="n">path</span><span class="p">,</span> <span class="n">post_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">'timestamp'</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">to_s</span>
    <span class="p">}</span>

    <span class="n">url</span> <span class="o">=</span> <span class="no">API_URL</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">'?'</span> <span class="o">+</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">'X-Api-Key'</span> <span class="o">=&gt;</span> <span class="no">API_KEY</span><span class="p">,</span>
      <span class="s1">'X-Api-Signature'</span> <span class="o">=&gt;</span> <span class="n">calc_auth_sig_hash</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">post_data</span><span class="p">.</span><span class="nf">to_json</span><span class="p">.</span><span class="nf">to_s</span><span class="p">),</span>
      <span class="s1">'X-Api-Version'</span> <span class="o">=&gt;</span> <span class="s1">'2'</span>
    <span class="p">}</span>

    <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span> <span class="no">API_URL</span>
    <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span> <span class="ss">:use_ssl</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
      <span class="n">http</span><span class="p">.</span><span class="nf">request_post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">post_data</span><span class="p">.</span><span class="nf">to_json</span><span class="p">.</span><span class="nf">to_s</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span>
        <span class="n">response</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span>
        <span class="k">raise</span> <span class="n">response</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]</span> <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="nf">code</span> <span class="o">!=</span> <span class="s1">'200'</span>
        <span class="k">return</span> <span class="n">response</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">calc_auth_sig_hash</span> <span class="n">url_body</span>
    <span class="k">return</span> <span class="no">Digest</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span> <span class="n">url_body</span><span class="p">,</span> <span class="no">SEC_KEY</span><span class="p">,</span> <span class="no">Digest</span><span class="o">::</span><span class="no">SHA256</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">api</span> <span class="o">=</span> <span class="no">WyreApi</span><span class="p">.</span><span class="nf">new</span>
<span class="n">api</span><span class="p">.</span><span class="nf">create_transfer</span><span class="p">({</span><span class="s1">'sourceAmount'</span><span class="o">=&gt;</span><span class="mi">50</span><span class="p">,</span><span class="s1">'sourceCurrency'</span><span class="o">=&gt;</span><span class="s1">'USD'</span><span class="p">,</span><span class="s1">'dest'</span><span class="o">=&gt;</span><span class="s1">'richard@epiapi.com'</span><span class="p">,</span> <span class="s1">'destCurrency'</span><span class="o">=&gt;</span><span class="s1">'USD'</span><span class="p">,</span> <span class="s1">'message'</span><span class="o">=&gt;</span><span class="s1">'buy Richard pizza'</span><span class="p">)</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c">#dependencies:</span>
<span class="c">#python3</span>
<span class="c">#pip3 install requests</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">request</span>

<span class="k">class</span> <span class="nc">MassPay_API</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_id</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_id</span> <span class="o">=</span> <span class="n">account_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="s">'https://api.testwyre.com/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">api_version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span> <span class="o">=</span> <span class="n">api_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span> <span class="o">=</span> <span class="n">api_secret</span>

    <span class="c">#authentication decorator. May raise ValueError if no json content is returned</span>
    <span class="k">def</span> <span class="nf">authenticate_request</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s">'?timestamp={}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="n">bodyJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="o">!=</span> <span class="s">''</span> <span class="k">else</span> <span class="s">''</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'application/json'</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Version'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Key'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Signature'</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">bodyJson</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="s">'SHA256'</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Signature'</span><span class="p">])</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="o">!=</span> <span class="s">''</span> <span class="k">else</span> <span class="bp">None</span><span class="p">),</span> <span class="n">json</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c">#Wyre will always try to give an err body</span>
                <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">wrap</span>

    <span class="nd">@authenticate_request</span>
    <span class="k">def</span> <span class="nf">retrieve_exchange_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">+</span> <span class="s">'/rates'</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">'GET'</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span>

    <span class="nd">@authenticate_request</span>
    <span class="k">def</span> <span class="nf">retrieve_account</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">+</span> <span class="s">'/account'</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">'GET'</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span>

    <span class="nd">@authenticate_request</span>
    <span class="k">def</span> <span class="nf">create_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceAmount</span><span class="p">,</span> <span class="n">sourceCurrency</span><span class="p">,</span> <span class="n">destAmount</span><span class="p">,</span> <span class="n">destCurrency</span><span class="p">,</span> <span class="n">destAddress</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">autoConfirm</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">+</span> <span class="s">'/transfers'</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">'POST'</span>
        <span class="c">#ONLY use either sourceAmount or destAmount, see documentation</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s">'sourceCurrency'</span><span class="p">:</span><span class="n">sourceCurrency</span><span class="p">,</span>
                <span class="s">'dest'</span><span class="p">:</span><span class="n">destAddress</span><span class="p">,</span>
                <span class="s">'destCurrency'</span><span class="p">:</span><span class="n">destCurrency</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span><span class="n">message</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">sourceAmount</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">"sourceAmount"</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourceAmount</span>
        <span class="k">elif</span> <span class="n">destAmount</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">"destAmount"</span><span class="p">]</span> <span class="o">=</span> <span class="n">destAmount</span>
        <span class="k">if</span> <span class="n">autoConfirm</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">'autoConfirm'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span>

    <span class="nd">@authenticate_request</span>
    <span class="k">def</span> <span class="nf">confirm_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">+</span> <span class="s">'/transfer/{}/confirm'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transfer_id</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">'POST'</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span>  

    <span class="nd">@authenticate_request</span>
    <span class="k">def</span> <span class="nf">status_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">+</span> <span class="s">'/transfer/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transfer_id</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">'GET'</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span>  

<span class="c">#USAGE Example</span>
<span class="n">account_id</span> <span class="o">=</span> <span class="s">"YOUR_ACCOUNT_ID_HERE"</span> <span class="c">#optional</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="s">"YOUR_API_KEY_HERE"</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="s">"YOUR_SECRET_KEY_HERE"</span>
<span class="n">api_version</span> <span class="o">=</span> <span class="s">"2"</span>

<span class="c">#create Wyre MassPay API object</span>
<span class="n">Wyre</span> <span class="o">=</span> <span class="n">MassPay_API</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">)</span>

<span class="c">#get account info</span>
<span class="n">http_code</span><span class="p">,</span> <span class="n">account</span> <span class="o">=</span> <span class="n">Wyre</span><span class="o">.</span><span class="n">retrieve_account</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">javax.crypto.Mac</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.DataOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.Integer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.String</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.StringBuffer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.HttpURLConnection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URL</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAuth</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">apiKey</span> <span class="o">=</span> <span class="s">"YOUR_API_KEY_HERE"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">secretKey</span> <span class="o">=</span> <span class="s">"YOUR_SECRET_KEY_HERE"</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.testwyre.com/account"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="s">"GET"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">executeWyreRequest</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">secretKey</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.testwyre.com/transfers"</span><span class="o">;</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s">"POST"</span><span class="o">;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
        <span class="s">"  \"dest\": \"richard@epiaapi.com\","</span> <span class="o">+</span>
        <span class="s">"  \"destCurrency\": \"USD\","</span> <span class="o">+</span>
        <span class="s">"  \"sourceCurrency\" : \"USD\","</span> <span class="o">+</span>
        <span class="s">"  \"sourceAmount\" : \"50\","</span> <span class="o">+</span>
        <span class="s">"  \"message\": \"buy Richard pizza\""</span> <span class="o">+</span>
        <span class="s">"}"</span><span class="o">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">executeWyreRequest</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">data</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">secretKey</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">executeWyreRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">targetURL</span><span class="o">,</span> <span class="n">String</span> <span class="n">requestBody</span><span class="o">,</span> <span class="n">String</span> <span class="n">method</span><span class="o">,</span> <span class="n">String</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">secretKey</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">URL</span> <span class="n">url</span><span class="o">;</span>
    <span class="n">HttpURLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>

      <span class="n">targetURL</span> <span class="o">+=</span> <span class="o">((</span><span class="n">targetURL</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s">"?"</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">)?</span><span class="s">"&amp;"</span><span class="o">:</span><span class="s">"?"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"timestamp="</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

      <span class="c1">//Create connection</span>
      <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">targetURL</span><span class="o">);</span>
      <span class="n">connection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span><span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">connection</span><span class="o">.</span><span class="na">getRequestMethod</span><span class="o">());</span>

      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">);</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">requestBody</span><span class="o">.</span><span class="na">getBytes</span><span class="o">().</span><span class="na">length</span><span class="o">));</span>

      <span class="c1">//Specify API v2</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Version"</span><span class="o">,</span><span class="s">"2"</span><span class="o">);</span>

      <span class="c1">// Provide API key and signature</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Key"</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">);</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Signature"</span><span class="o">,</span><span class="n">computeSignature</span><span class="o">(</span><span class="n">secretKey</span><span class="o">,</span><span class="n">targetURL</span><span class="o">,</span><span class="n">requestBody</span><span class="o">));</span>

      <span class="c1">//Send request</span>
      <span class="k">if</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">setDoOutput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>

        <span class="n">DataOutputStream</span> <span class="n">wr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataOutputStream</span><span class="o">(</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>

        <span class="n">wr</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">requestBody</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">));</span>
        <span class="n">wr</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">wr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span>

      <span class="c1">//Get Response</span>
      <span class="n">InputStream</span> <span class="n">is</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">connection</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_BAD_REQUEST</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">is</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

        <span class="n">is</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getErrorStream</span><span class="o">();</span>
      <span class="o">}</span>

      <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">));</span>
      <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
      <span class="n">StringBuffer</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
      <span class="k">while</span><span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">'\r'</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">rd</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>

      <span class="k">if</span><span class="o">(</span><span class="n">connection</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">computeSignature</span><span class="o">(</span><span class="n">String</span> <span class="n">secretKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">reqData</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">reqData</span><span class="o">;</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Mac</span> <span class="n">sha256Hmac</span> <span class="o">=</span> <span class="n">Mac</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"HmacSHA256"</span><span class="o">);</span>
      <span class="n">SecretKeySpec</span> <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecretKeySpec</span><span class="o">(</span><span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="s">"HmacSHA256"</span><span class="o">);</span>
      <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>

      <span class="kt">byte</span><span class="o">[]</span> <span class="n">macData</span> <span class="o">=</span> <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">));</span>

      <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span> <span class="n">element</span> <span class="o">:</span> <span class="n">macData</span><span class="o">){</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">((</span><span class="n">element</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="o">)</span> <span class="o">+</span> <span class="mh">0x100</span><span class="o">,</span> <span class="mi">16</span><span class="o">).</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">make_authenticated_request</span><span class="p">(</span><span class="nv">$endpoint</span><span class="p">,</span> <span class="nv">$method</span><span class="p">,</span> <span class="nv">$body</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$url</span> <span class="o">=</span> <span class="s1">'https://api.testwyre.com'</span><span class="p">;</span>
        <span class="nv">$api_key</span> <span class="o">=</span> <span class="s2">"YOUR_API_KEY_HERE"</span><span class="p">;</span>
        <span class="nv">$secret_key</span> <span class="o">=</span> <span class="s2">"YOUR_SECRET_KEY_HERE"</span><span class="p">;</span>

        <span class="nv">$timestamp</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">(</span><span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
        <span class="nv">$request_url</span> <span class="o">=</span> <span class="nv">$url</span> <span class="o">.</span> <span class="nv">$endpoint</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$request_url</span><span class="p">,</span><span class="s2">"?"</span><span class="p">))</span>
            <span class="nv">$request_url</span> <span class="o">.=</span> <span class="s1">'&amp;timestamp='</span> <span class="o">.</span> <span class="nv">$timestamp</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="nv">$request_url</span> <span class="o">.=</span> <span class="s1">'?timestamp='</span> <span class="o">.</span> <span class="nv">$timestamp</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$body</span><span class="p">))</span>
            <span class="nv">$body</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$body</span><span class="p">,</span> <span class="nx">JSON_FORCE_OBJECT</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="nv">$body</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

        <span class="nv">$headers</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s2">"Content-Type: application/json"</span><span class="p">,</span>
            <span class="s2">"X-Api-Key: "</span><span class="o">.</span> <span class="nv">$api_key</span><span class="p">,</span>
            <span class="s2">"X-Api-Signature: "</span><span class="o">.</span> <span class="nx">calc_auth_sig_hash</span><span class="p">(</span><span class="nv">$secret_key</span><span class="p">,</span> <span class="nv">$request_url</span> <span class="o">.</span> <span class="nv">$body</span><span class="p">),</span>
            <span class="s2">"X-Api-Version: 2"</span>
        <span class="p">);</span>
        <span class="nv">$curl</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$method</span><span class="o">==</span><span class="s2">"POST"</span><span class="p">){</span>
          <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">CURLOPT_URL</span>             <span class="o">=&gt;</span> <span class="nv">$request_url</span><span class="p">,</span>
            <span class="nx">CURLOPT_POST</span>            <span class="o">=&gt;</span>  <span class="kc">true</span><span class="p">,</span>
            <span class="nx">CURLOPT_POSTFIELDS</span>      <span class="o">=&gt;</span> <span class="nv">$body</span><span class="p">,</span>
            <span class="nx">CURLOPT_RETURNTRANSFER</span>  <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
          <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">CURLOPT_URL</span>             <span class="o">=&gt;</span> <span class="nv">$request_url</span><span class="p">,</span>
            <span class="nx">CURLOPT_RETURNTRANSFER</span>  <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nb">curl_setopt_array</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="nv">$headers</span><span class="p">);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
        <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">calc_auth_sig_hash</span><span class="p">(</span><span class="nv">$seckey</span><span class="p">,</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$hash</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="nv">$val</span><span class="p">,</span> <span class="nv">$seckey</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$hash</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">echo</span> <span class="nx">make_authenticated_request</span><span class="p">(</span><span class="s2">"/account"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
    <span class="nv">$transfer</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
      <span class="s2">"sourceCurrency"</span><span class="o">=&gt;</span><span class="s2">"USD"</span><span class="p">,</span>
      <span class="s2">"dest"</span><span class="o">=&gt;</span><span class="s2">"richard@epiapi.com"</span><span class="p">,</span>
      <span class="s2">"sourceAmount"</span><span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span>
      <span class="s2">"destCurrency"</span><span class="o">=&gt;</span><span class="s2">"USD"</span><span class="p">,</span>
      <span class="s2">"amountIncludesFees"</span><span class="o">=&gt;</span><span class="nx">True</span>
      <span class="s2">"message"</span><span class="o">=&gt;</span> <span class="s2">"buy Richard pizza"</span>
      <span class="p">);</span>
    <span class="k">echo</span> <span class="nx">make_authenticated_request</span><span class="p">(</span><span class="s2">"/transfers"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">,</span> <span class="nv">$transfer</span><span class="p">);</span>
    <span class="cp">?&gt;</span>
</code></pre><pre class="highlight csharp tab-csharp"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Cryptography</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">testauthwyre</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">MainClass</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">WyreApi</span> <span class="n">wyre</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WyreApi</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">DateTimeOffset</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="nf">ToUnixTimeMilliseconds</span><span class="p">());</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">((</span><span class="kt">long</span><span class="p">)(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">DateTimeKind</span><span class="p">.</span><span class="n">Utc</span><span class="p">)).</span><span class="n">TotalMilliseconds</span><span class="p">);</span>
            <span class="n">HttpWebResponse</span> <span class="n">accountResponse</span> <span class="p">=</span> <span class="n">wyre</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">"/account"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="nf">GetResponseBody</span><span class="p">(</span><span class="n">accountResponse</span><span class="p">));</span>
            <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">body</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;();</span>
            <span class="n">body</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"sourceCurrency"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">);</span>
            <span class="n">body</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"sourceAmount"</span><span class="p">,</span> <span class="s">"50"</span><span class="p">);</span>
            <span class="n">body</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"dest"</span><span class="p">,</span> <span class="s">"richard@epiapi.com"</span><span class="p">);</span>
            <span class="n">HttpWebResponse</span> <span class="n">transferResponse</span> <span class="p">=</span> <span class="n">wyre</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="s">"/transfers"</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="nf">GetResponseBody</span><span class="p">(</span><span class="n">transferResponse</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetResponseBody</span><span class="p">(</span><span class="n">HttpWebResponse</span> <span class="n">response</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">JObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">GetResponseStream</span><span class="p">()).</span><span class="nf">ReadToEnd</span><span class="p">()).</span><span class="nf">ToString</span><span class="p">(</span><span class="n">Formatting</span><span class="p">.</span><span class="n">Indented</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WyreApi</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="n">String</span> <span class="n">domain</span> <span class="p">=</span> <span class="s">"https://api.testwyre.com"</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="n">String</span> <span class="n">apiKey</span> <span class="p">=</span> <span class="s">"YOUR_API_KEY_HERE"</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="n">String</span> <span class="n">secKey</span> <span class="p">=</span> <span class="s">"YOUR_SECRET_KEY_HERE"</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">HttpWebResponse</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;());</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="n">HttpWebResponse</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">queryParams</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Request</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">queryParams</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="n">HttpWebResponse</span> <span class="nf">Post</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">body</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Request</span><span class="p">(</span><span class="s">"POST"</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="n">HttpWebResponse</span> <span class="nf">Request</span><span class="p">(</span><span class="kt">string</span> <span class="n">method</span><span class="p">,</span> <span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">body</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">queryParams</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"GET"</span><span class="p">))</span>
                <span class="n">queryParams</span> <span class="p">=</span> <span class="n">body</span><span class="p">;</span>
            <span class="n">queryParams</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="nf">GetTimestamp</span><span class="p">());</span>
            <span class="kt">string</span> <span class="n">queryString</span> <span class="p">=</span> <span class="n">queryParams</span><span class="p">.</span><span class="nf">Aggregate</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">previous</span> <span class="p">+</span> <span class="s">"&amp;"</span> <span class="p">+</span> <span class="n">current</span><span class="p">.</span><span class="n">Key</span> <span class="p">+</span> <span class="s">"="</span> <span class="p">+</span> <span class="n">current</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="nf">Remove</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
            <span class="kt">string</span> <span class="n">url</span> <span class="p">=</span> <span class="n">domain</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="s">"?"</span> <span class="p">+</span> <span class="n">queryString</span><span class="p">;</span>
            <span class="n">HttpWebRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="p">(</span><span class="n">HttpWebRequest</span><span class="p">)</span><span class="n">WebRequest</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
            <span class="n">request</span><span class="p">.</span><span class="n">Method</span> <span class="p">=</span> <span class="n">method</span><span class="p">;</span>
            <span class="n">request</span><span class="p">.</span><span class="n">ContentType</span> <span class="p">=</span> <span class="s">"application/json"</span><span class="p">;</span>
            <span class="n">request</span><span class="p">.</span><span class="n">AutomaticDecompression</span> <span class="p">=</span> <span class="n">DecompressionMethods</span><span class="p">.</span><span class="n">GZip</span> <span class="p">|</span> <span class="n">DecompressionMethods</span><span class="p">.</span><span class="n">Deflate</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">method</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"GET"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">url</span> <span class="p">+=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">StreamWriter</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamWriter</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">GetRequestStream</span><span class="p">()))</span>
                    <span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">body</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">request</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-Api-Key"</span><span class="p">]</span> <span class="p">=</span> <span class="n">apiKey</span><span class="p">;</span>
            <span class="n">request</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-Api-Signature"</span><span class="p">]</span> <span class="p">=</span> <span class="nf">CalcAuthSigHash</span><span class="p">(</span><span class="n">secKey</span><span class="p">,</span> <span class="n">url</span><span class="p">);</span>
            <span class="n">request</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-Api-Version"</span><span class="p">]</span> <span class="p">=</span> <span class="s">"2"</span><span class="p">;</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">HttpWebResponse</span><span class="p">)</span><span class="n">request</span><span class="p">.</span><span class="nf">GetResponse</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="n">WebException</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">msg</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">GetResponseStream</span><span class="p">()).</span><span class="nf">ReadToEnd</span><span class="p">();</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">SystemException</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="kt">byte</span><span class="p">[]</span> <span class="nf">GetBytes</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="nf">GetString</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">bytes</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="kt">long</span> <span class="nf">GetTimestamp</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// return DateTimeOffset.UtcNow.ToUnixTimeMilliseconds() // .NET 4.6</span>
            <span class="k">return</span> <span class="p">(</span><span class="kt">long</span><span class="p">)(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1970</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">DateTimeKind</span><span class="p">.</span><span class="n">Utc</span><span class="p">)).</span><span class="n">TotalMilliseconds</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="n">String</span> <span class="nf">CalcAuthSigHash</span><span class="p">(</span><span class="kt">string</span> <span class="n">key</span><span class="p">,</span> <span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">HMACSHA256</span> <span class="n">hmac</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HMACSHA256</span><span class="p">(</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">));</span>
            <span class="kt">string</span> <span class="n">hash</span> <span class="p">=</span> <span class="nf">GetString</span><span class="p">(</span><span class="n">hmac</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="nf">GetBytes</span><span class="p">(</span><span class="k">value</span><span class="p">))).</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"-"</span><span class="p">,</span> <span class="s">""</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">hash</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>我们采用一系列加密机制来确保您发送请求的安全性。以下是关于如何发送安全的带验签请求的指南。</p>

<p>发送带验签请求时，您需要将一系列值放入HTTP的请求头。</p>

<table><thead>
<tr>
<th>HTTP 请求头</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>X-Api-Key</td>
<td>您的 API key, 点击 <a href="https://epiapi.zendesk.com/hc/en-us/articles/360009109612-API-Key-%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%8D%97">这里</a></td>
</tr>
<tr>
<td>X-Api-Signature</td>
<td>用于验证的签名，由账户持有者发送。具体请查看下一步<a href="#1028ed81a3">计算签名</a></td>
</tr>
</tbody></table>

<p>除此以外，您应在发送请求时将包含<code>GET</code>参数的时间戳放在Url之后，<strong>UNIX毫秒单位</strong>。我们会通过时间戳来避免重复请求攻击。</p>
<h2 id='1028ed81a3'>计算签名</h2>
<p>如果发送<code>GET</code>请求，请将此Url计算入签名：<em>https://api.testwyre.com/v2/rates?timestamp=1426252182534</em></p>

<p>如果发送<code>POST</code>请求，请将此Url计算入签名：<em>https://api.testwyre.com/v2/transfers?timestamp=1426252182534</em></p>

<p>请留意发送<code>POST</code>请求时，必须将请求体（request body）加在URL字符串之后。请求体必须按原样发送，不得修改。服务器会据此计算其内容。</p>

<p><strong>计算签名步骤：</strong></p>

<p>1.request URL 加 HTTP 请求体，串联生成 UTF-8 编码字符串。<code>GET</code>的请求体则创建空白字符串。</p>

<p>2.使用HMAC-SHA256协议，以及您的API密钥计算签名。</p>
<h2 id='f43db85ea6'>资源名称</h2>
<p>SRN是我们平台约定的，调用库内各项数据时使用的资源名称。许多我们的API交互和数据库框架都需要用到SRN，它大大增加了集成开发的灵活性，也为后续隔离开发其他服务提供便利。所有资源名称皆遵照如下格式：</p>

<table><thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>contact</td>
<td>联系人识别号 (contact:CO-123123123)</td>
</tr>
<tr>
<td>paymentmethod</td>
<td>收款方式 (paymentMethod:PA-123123123)</td>
</tr>
<tr>
<td>email</td>
<td>邮箱地址 (email:test@epiapi.com)</td>
</tr>
<tr>
<td>cellphone</td>
<td>手机号码 (cellphone:+8615555555555)</td>
</tr>
<tr>
<td>account</td>
<td>平台账户号 (account:AC-123123123)</td>
</tr>
<tr>
<td>wallet</td>
<td>子钱包 (wallet:WA-123123123)</td>
</tr>
<tr>
<td>transfer</td>
<td>转账 (可能包含结汇) (transfer:TF-123123123)</td>
</tr>
</tbody></table>
<h2 id='9836a95e9d'>费用</h2>
<p>我们将根据双方签署的纸质协议计算费用。VBA+每日结算的标准服务收费为0.25%。</p>
<h2 id='128e9ff023'>错误处理</h2>
<p>请求成功后，返回值为HTTP 200，请求体具体格式取决于终端节点。</p>

<p>如果出现错误，返回值为4XX或5XX的状态码，具体描述参见下表：</p>

<table><thead>
<tr>
<th>错误</th>
<th>描述</th>
<th>HTTPs状态码</th>
</tr>
</thead><tbody>
<tr>
<td>ValidationException</td>
<td>请求执行失败</td>
<td>400</td>
</tr>
<tr>
<td>UnknownException</td>
<td>系统内部错误，极少出现</td>
<td>500</td>
</tr>
<tr>
<td>InsufficientFundsException</td>
<td>账户内没有足够余额来执行请求</td>
<td>400</td>
</tr>
<tr>
<td>RateLimitException</td>
<td>请求受限，请联系客服增加请求次数</td>
<td>429</td>
</tr>
<tr>
<td>AccessDeniedException</td>
<td>没有权限执行相关请求</td>
<td>401</td>
</tr>
<tr>
<td>TransferException</td>
<td>转账请求出现问题</td>
<td>400</td>
</tr>
<tr>
<td>NotFoundException</td>
<td>请求中有相关内容未能查找到</td>
<td>400</td>
</tr>
<tr>
<td>ValidationException</td>
<td>请求中有相关内容未能通过验证</td>
<td>400</td>
</tr>
<tr>
<td>CustomerSupportException</td>
<td>请通过 support@epiapi.com 联系客服来解决此问题</td>
<td>400</td>
</tr>
<tr>
<td>MFARequiredException</td>
<td>需要多重验证来执行请求，通常在使用API密钥的情况下不会出现此类情况</td>
<td>400</td>
</tr>
</tbody></table>

<p>所有错误描述都会附带子类型参数来解释该错误的详细信息。除此之外，一些验证失败返回值会带有两个字段，问题字段和问题值，详细指出错误位置。</p>

<p><strong>一些常见的验证失败子类：</strong></p>

<p>FIELD_REQUIRED  字段未填写</p>

<p>INVALID_VALUE   无效值</p>

<p>TRANSACTION_AMOUNT_TOO_SMALL  交易值过小</p>

<p>UNSUPPORTED_SOURCE_CURRENCY   非支持货币种类</p>

<p>CANNOT_SEND_SELF_FUNDS        自账户不能转账</p>

<p>INVALID_PAYMENT_METHOD        收款方无效</p>

<p>PAYMENT_METHOD_INACTIVE       收款方未激活</p>

<p>PAYMENT_METHOD_UNSUPPORTED_CHARGE_CURRENCY    不支持该币种转账</p>

<p>PAYMENT_METHOD_UNCHARGEABLE                   不支持此付款方式充值</p>

<p>PAYMENT_METHOD_UNSUPPORTED_DEPOSIT_CURRENCY   不支持该币种充值</p>
<h1 id='1d33fae982'>操作指南</h1>
<p>以下指南将为您详细解读通过api交互创建美元收款产品的全部步骤。</p>
<h2 id='a573be9f55'>虚拟银行</h2>
<p><strong>在epiapi平台搭建自己的美元收款产品</strong></p>

<p>epiapi提供多种api集成方式，帮助您按需求搭建不同类型收款产品。为了帮助开发者更好地理解我们的系统如何运行，以下将为您提供一个典型的使用案例。</p>

<p>这是一家在线平台如何利用epiapi搭建产品，从而为其用户提供独立账号的美元收款服务的整个流程，包括创建虚拟银行子钱包，接收款项，并结算至用户账户等。</p>
<h3 id='1-kyc'>1.使用KYC数据创建子钱包</h3>
<p>epiapi使用<code>子钱包（wallet）</code>这一概念来描述个人商家的账户，子钱包统一创建在您的<code>母账户（account）</code>之下。创建后，每一个子钱包都具有独立的收款功能。请注意在<code>Type</code>字段必须为<code>type=VBA</code>，否则将无法收到虚拟银行服务账号的银行信息。</p>

<p><code>POST</code> https://api.testwyre.com/v2/wallets</p>

<pre class="center-column">
{
  "name":"youruniquename",
  "type":"VBA",
  "callbackUrl":"https://your.website.io/callback",
  "vbaVerificationData":{
    "entityType":"CORP",
    "entityScope":"Shopping/Retail",
    "email":"test+merchant@epiapi.com",
    "phoneNumber":"13111111111",
    "ip": "127.0.0.1",
    "nameCn":"法人姓名",
    "nameEn":"Legal Rep",
    "dateOfBirth":1514736000,
    "address":{
      "city":"北京",
      "country":"CN",
      "postalCode":"210000",
      "street1":"东四北大街107号",
      "street2":"克林大厦107室"},
    "idNumber":"432524199902287897",
    "idDoc":null,
    "merchantIds":[{
    "merchantId":"AAAAAAAAAAA",
    "merchantType":"Amazon"}],
    "expectedMonthlySales":40000,
    "shopName":"MyBrand",
    "website":"https://merchant.website.com",
    "repAaddress":{
      "city":"北京",
      "country":"CN",
      "postalCode":"210000",
      "street1":"东四北大街107号",
      "street2":"克林大厦107室"},
    "companyNameCn":"ABC有限责任公司",
    "companyNameEn":"ABC Company Limited",
    "registrationNumber":"123456789",
    "coiDoc":null,
    "salesDoc":null,
    "dateOfEstablishment":1514736000,
    "beneficialOwners":[{
      "fullName":"Richard",
      "idNumber":"1231321312",
      "idDoc":null}]
      }
}
</pre>

<p><br>
<strong>KYC 资料</strong></p>

<table><thead>
<tr>
<th>字段(* 代表必填)</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>&quot;entityType&quot; *</td>
<td>可填&quot;CORP&quot;、“M”、“F”</td>
</tr>
<tr>
<td>&quot;entityScope&quot; *</td>
<td>&quot;Shopping/Retail&quot;</td>
</tr>
<tr>
<td>&quot;email&quot; *</td>
<td>&quot;test+merchant@epiapi.com&quot;</td>
</tr>
<tr>
<td>&quot;phoneNumber&quot; *</td>
<td>&quot;13111111111&quot;</td>
</tr>
<tr>
<td>&quot;ip&quot; *</td>
<td>“登陆店铺常用IP地址”</td>
</tr>
<tr>
<td>&quot;nameCn&quot; *</td>
<td>&quot;法人姓名&quot;</td>
</tr>
<tr>
<td>&quot;nameEn&quot; *</td>
<td>&quot;Legal Rep&quot; 拼音，全大写</td>
</tr>
<tr>
<td>&quot;dateOfBirth&quot; *</td>
<td>UNIX毫秒单位</td>
</tr>
<tr>
<td>&quot;address&quot; *</td>
<td>(street 2 可以不填)</td>
</tr>
<tr>
<td>&quot;street1&quot;</td>
<td>&quot;东四北大街107号&quot;</td>
</tr>
<tr>
<td>&quot;street2&quot;</td>
<td>&quot;克林大厦107室&quot;</td>
</tr>
<tr>
<td>&quot;city&quot;</td>
<td>&quot;beijing&quot;</td>
</tr>
<tr>
<td>&quot;state&quot;</td>
<td>&quot;beijing&quot;</td>
</tr>
<tr>
<td>&quot;country&quot;</td>
<td>&quot;CN&quot;</td>
</tr>
<tr>
<td>&quot;postalCode&quot;</td>
<td>&quot;100007&quot;</td>
</tr>
<tr>
<td>&quot;idNumber&quot; *</td>
<td>&quot;432524199902287897&quot;</td>
</tr>
<tr>
<td>&quot;idDoc&quot; *</td>
<td>null</td>
</tr>
<tr>
<td>&quot;merchantId&quot;</td>
<td>&quot;A00000&quot;</td>
</tr>
<tr>
<td>&quot;merchantType&quot;</td>
<td>&quot;Amazon&quot;</td>
</tr>
<tr>
<td>&quot;expectedMonthlySales&quot;</td>
<td>40000</td>
</tr>
<tr>
<td>&quot;shopName&quot;</td>
<td>&quot;MyBrand&quot;</td>
</tr>
<tr>
<td>&quot;website&quot;</td>
<td>&quot;https://merchant.website.com&quot;</td>
</tr>
<tr>
<td>&quot;repAaddress&quot;(* 限企业)</td>
<td>(street 2 可以不填)</td>
</tr>
<tr>
<td>&quot;street1&quot;</td>
<td>&quot;东四北大街107号&quot;</td>
</tr>
<tr>
<td>&quot;street2&quot;</td>
<td>&quot;克林大厦107室&quot;</td>
</tr>
<tr>
<td>&quot;city&quot;</td>
<td>&quot;beijing&quot;</td>
</tr>
<tr>
<td>&quot;state&quot;</td>
<td>&quot;beijing&quot;</td>
</tr>
<tr>
<td>&quot;country&quot;</td>
<td>&quot;CN&quot;</td>
</tr>
<tr>
<td>&quot;postalCode&quot;</td>
<td>&quot;100007&quot;</td>
</tr>
<tr>
<td>&quot;companyNameCn&quot;(* 限企业)</td>
<td>&quot;ABC有限责任公司&quot;</td>
</tr>
<tr>
<td>&quot;companyNameEn&quot;( * 限企业)</td>
<td>&quot;ABC Company Limited&quot;</td>
</tr>
<tr>
<td>&quot;registrationNumber&quot;(* 限企业)</td>
<td>&quot;123456789&quot;</td>
</tr>
<tr>
<td>&quot;coiDoc&quot;(* 限企业)</td>
<td>null</td>
</tr>
<tr>
<td>&quot;salesDoc&quot;(流水额高的商户可能需要提供)</td>
<td>null</td>
</tr>
<tr>
<td>&quot;dateOfEstablishment&quot; *</td>
<td>UNIX毫秒单位</td>
</tr>
<tr>
<td>&quot;beneficialOwners&quot;(仅限香港注册企业)</td>
<td></td>
</tr>
<tr>
<td>&quot;fullName&quot;</td>
<td>&quot;Richard&quot;</td>
</tr>
<tr>
<td>&quot;idNumber&quot;</td>
<td>&quot;1231321312&quot;</td>
</tr>
<tr>
<td>&quot;idDoc&quot;</td>
<td>null</td>
</tr>
</tbody></table>
<pre class="highlight plaintext"><code>curl -v -XPOST 'https://api.testwyre.com/v2/wallets' \
  -H "Content-Type: application/json" \
  -H "X-Api-Key: {api-key}" \
  -H "X-Api-Signature: {signature}" \
  -d '{"type":"VBA","name":"{your-unique-identifier}"
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"callbackUrl"</span><span class="p">:</span><span class="s2">"https://your.website.io/callback"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"12345678977897800"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"VBA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"vbaVerificationData"</span><span class="p">:{</span><span class="w">
    </span><span class="s2">"entityType"</span><span class="p">:</span><span class="s2">"CORP"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"entityScope"</span><span class="p">:</span><span class="s2">"Shopping/Retail"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"test+merchant@epiapi.com"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"phoneNumber"</span><span class="p">:</span><span class="s2">"13111111111"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ip"</span><span class="p">:</span><span class="s2">"127.0.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nameCn"</span><span class="p">:</span><span class="s2">"法人姓名"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nameEn"</span><span class="p">:</span><span class="s2">"Legal Rep"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"dateOfBirth"</span><span class="p">:</span><span class="mi">1514736000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"address"</span><span class="p">:{</span><span class="w">
      </span><span class="s2">"city"</span><span class="p">:</span><span class="s2">"北京"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country"</span><span class="p">:</span><span class="s2">"CN"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"postalCode"</span><span class="p">:</span><span class="s2">"210000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"street1"</span><span class="p">:</span><span class="s2">"东四北大街107号"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"street2"</span><span class="p">:</span><span class="s2">"克林大厦107室"</span><span class="p">},</span><span class="w">
    </span><span class="s2">"idNumber"</span><span class="p">:</span><span class="s2">"432524199902287897"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"idDoc"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchantIds"</span><span class="p">:[{</span><span class="w">
    </span><span class="s2">"merchantId"</span><span class="p">:</span><span class="s2">"AAAAAAAAAAA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchantType"</span><span class="p">:</span><span class="s2">"Amazon"</span><span class="p">}],</span><span class="w">
    </span><span class="s2">"expectedMonthlySales"</span><span class="p">:</span><span class="mi">40000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"shopName"</span><span class="p">:</span><span class="s2">"MyBrand"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"website"</span><span class="p">:</span><span class="s2">"https://merchant.website.com"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"repAaddress"</span><span class="p">:{</span><span class="w">
      </span><span class="s2">"city"</span><span class="p">:</span><span class="s2">"北京"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country"</span><span class="p">:</span><span class="s2">"CN"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"postalCode"</span><span class="p">:</span><span class="s2">"210000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"street1"</span><span class="p">:</span><span class="s2">"东四北大街107号"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"street2"</span><span class="p">:</span><span class="s2">"克林大厦107室"</span><span class="p">},</span><span class="w">
    </span><span class="s2">"companyNameCn"</span><span class="p">:</span><span class="s2">"ABC有限责任公司"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"companyNameEn"</span><span class="p">:</span><span class="s2">"ABC Company Limited"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"registrationNumber"</span><span class="p">:</span><span class="s2">"123456789"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"coiDoc"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"salesDoc"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"dateOfEstablishment"</span><span class="p">:</span><span class="mi">1514736000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficialOwners"</span><span class="p">:[{</span><span class="w">
      </span><span class="s2">"fullName"</span><span class="p">:</span><span class="s2">"Richard"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"idNumber"</span><span class="p">:</span><span class="s2">"1231321312"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"idDoc"</span><span class="p">:</span><span class="kc">null</span><span class="p">}]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre>
<p>平台用户申请使用VBA服务时，为这个用户<a href="#5aea6fa68a">创建钱包</a>。</p>

<p>注：</p>

<p>1.根据相关法规要求，为了给用户开通虚拟银行服务，您需要从用户处收集必要的KYC信息并将其通过终端节点传送给我们。钱包会立即开通，相关的银行信息将在之后该账户被银行批准时提供。（步骤3）</p>

<p>2.每个子钱包将在创建时自动生成一个子钱包id。</p>

<p>3.请将返回记录中的<code>walletId</code>记录下来，稍后将会用到。</p>
<h3 id='2-kyc'>2.上传KYC文件</h3>
<p><code>POST</code> https://api.testwyre.com/v2/documents</p>

<p>创建VBA子钱包需要提供以下文件来通过KYC审查，通过后才能获得<code>accountNumber</code>。通过此终端节点上传完文件后，返回记录中将包含步骤3所需的<code>documentId</code>。</p>

<p>更新时请在Url之后加入如下参数:</p>

<p>字段 |描述
--------- |
ownerSrn:  |&quot;wallet:[WALLET_ID]&quot;
filename |文件名，（可填）: &quot;coiDoc.pdf&quot;</p>

<p>示例 <code>POST</code> https://api.testwyre.com/v2/documents?ownerSrn=wallet:WA-123123123&amp;filename=coiDoc.pdf</p>

<p>在请求体中包含原始字节文件上传。</p>
<pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">computeSignature2</span><span class="o">(</span><span class="n">String</span> <span class="n">secretKey</span><span class="o">,</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">reqData</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">UnsupportedEncodingException</span> <span class="o">{</span>

       <span class="kt">byte</span><span class="o">[]</span> <span class="n">urlBytes</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>

       <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">urlBytes</span><span class="o">.</span><span class="na">length</span><span class="o">+</span><span class="n">reqData</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>

       <span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">urlBytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">data</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">urlBytes</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
       <span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">reqData</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">data</span><span class="o">,</span><span class="n">urlBytes</span><span class="o">.</span><span class="na">length</span><span class="o">,</span><span class="n">reqData</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>

       <span class="k">try</span> <span class="o">{</span>
           <span class="n">Mac</span> <span class="n">sha256Hmac</span> <span class="o">=</span> <span class="n">Mac</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"HmacSHA256"</span><span class="o">);</span>
           <span class="n">SecretKeySpec</span> <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecretKeySpec</span><span class="o">(</span><span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="s">"HmacSHA256"</span><span class="o">);</span>
           <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>

           <span class="kt">byte</span><span class="o">[]</span> <span class="n">macData</span> <span class="o">=</span> <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

           <span class="n">StringBuffer</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
           <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span> <span class="n">element</span> <span class="o">:</span> <span class="n">macData</span><span class="o">){</span>
               <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">((</span><span class="n">element</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="o">)</span> <span class="o">+</span> <span class="mh">0x100</span><span class="o">,</span> <span class="mi">16</span><span class="o">).</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
           <span class="o">}</span>
           <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>

       <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
           <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
       <span class="o">}</span>
   <span class="o">}</span>
</code></pre>
<p>最后，请求头中应反映文件类型，允许上传的文件类型有：</p>

<table><thead>
<tr>
<th>文件类型</th>
</tr>
</thead><tbody>
<tr>
<td>&quot;application/msword&quot;</td>
</tr>
<tr>
<td>&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</td>
</tr>
<tr>
<td>&quot;application/pdf&quot;</td>
</tr>
<tr>
<td>&quot;image/jpg&quot;</td>
</tr>
<tr>
<td>&quot;image/jpeg&quot;</td>
</tr>
<tr>
<td>&quot;image/png&quot;</td>
</tr>
</tbody></table>

<p><br></p>

<p>文件上传成功后，返回将接收到名为&quot;document&quot;的对象。将每一项的文件id( 如DO-123123123 )记录下来，填入创建钱包请求体的相关字段中。</p>

<table><thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>idDoc</td>
<td>身份证明(中国大陆居民此项必须提供二代身份证)</td>
</tr>
<tr>
<td>coiDoc</td>
<td>企业营业执照</td>
</tr>
<tr>
<td>salesDoc</td>
<td>网店销售流水*</td>
</tr>
</tbody></table>

<p>对于亚马逊商户-请使用ListFinancialEventsGroup接口获取并上传内容为近三个月销售记录的xml文件。</p>
<h3 id='3-kyc'>3. 填入KYC数据</h3>
<p>一旦文件上传成功后，将生成与子钱包关联的资源名称。为了区别每个文件，请将Id一一对应填入<code>vbaVerificationData</code>字段的相关字段：</p>

<pre class="center-column">
{
  "vbaVerificationData":{
    "coiDoc":"DO-123123123",
    "idDoc":"DO-123123124",
    "salesDoc":"DO-123123125"
  }
}
</pre>

<p><br></p>
<h3 id='4'>4. 查询银行信息</h3>
<p>银行信息将作为<code>object</code>添加到子钱包里的<code>vbaData</code>字段下。</p>

<pre class="center-column">
{   
  "vbaData": {
    "bankName":"Evolve Bank & Trust",
    "bankAddress": "6070 Poplar Ave #100, Memphis TN 38119",
    "beneficiaryName":"Zhang San",
    "bankAccountNumber":"123123123",
    "routingNumber":"084106768"}
  }
</pre>

<p><br>
使用 <code>GET</code> https://api.testwyre.com/v2/wallet/[walletID] 查询子钱包的银行信息。将查询请求发送次数限制为每小时1次，查询到信息后即停止查询请求。稍后我们将为此类场景单独创建一个回调。</p>

<p>一旦收到信息后，您可以将银行信息发给用户，让用户在自己的店铺后台进行收款信息更新。</p>
<h3 id='5'>5.接收款项与回调</h3>
<p>如果提前设置了<code>callbackUrl</code>，当用户的<code>accountNumber</code>接收到一笔款项，且款项成功入账后（从非合作平台打入的款项将被拒绝），您将收到入账的返回信息。</p>

<p>查看<a href="#c76b97433d">回调</a>。</p>

<p>如果需要验证回调，可以使用<code>Id</code>来<code>GET</code>必要的信息。epiapi系统内每笔转账都有独立的id (如 TF-123123123) 来供查询，查看：
<em>https://api.testwyre.com/v2/transfer/[id]</em></p>

<p>外部入账如亚马逊款项入账的情况，则会创建交易id (如 TR-123123123) 来供查询，查看: <em>https://api.testwyre.com/v2//transaction/[id]</em></p>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
  "createdAt":1531445525097,
  "id":"TR-F3947W8C2C6",
  "source":"transfer:TF-HP4A42EC6DX",
  "dest":"wallet:WA-CF9RFZ7QU6W",
  "currency":"USD",
  "amount":5005.00,
  "status":"CONFIRMED",
  "confirmedAt":1531445525097,
  "cancelledAt":null,
  "reversedAt":null,
  "message":"Deposit for transfer TF-HP4A42EC6DX",
  "allowOverdraft":true,
  "authorizer":"account:AC-XXXXXXXXX",
  "senderProvidedId":null,
  "reversedBy":null,
  "fees":0,
  "feesDest":null,
  "metadata":{
    "Description":"Pending: Transfer of $5005.00 to wallet:WA-CF9RFZ7QU6W",
    "transferId":"TF-HP4A42EC6DX"},
    "tags":[],
    "sourceFees":null,
    "destFees":null
  }
</pre>

<p><br></p>
<h3 id='6'>6. 将美元从子钱包转至母账户</h3>
<p><code>POST</code> https://api.testwyre.com/v2/transfers</p>

<pre class="center-column">
{
"source": "wallet:walletId",
"dest": "account:accountId",
"sourceCurrency": "USD",
"destCurrency": "USD",
"destAmount": 1000,
"autoConfirm": "true",
"message":"Merchant Test"
}
</pre>

<p>点击<a href="https://www.testwyre.com/settings/basic-info">这里</a>查询母账户id。</p>

<p>然后将美元款项转账至事先准备好的结算账户（注：账户创建时，epiapi默认将结算账户创建为<code>paymentMethod</code>）。</p>

<pre class="center-column">
{
"source": "account:accountId",
"dest": "paymentMethod:paymentMethodId",
"sourceCurrency": "USD",
"destCurrency": "USD",
"sourceAmount": 1000,
"amountIncludesFees": "true",
"autoConfirm": "true",
"message":"Merchant Test"
}
</pre>

<p>将<code>autoConfirm</code>（自动确认）的值设置为‘true’，来自动确认转账。</p>
<h1 id='c3d92b20c8'>账户</h1><h2 id='bd9157656f'>账户信息</h2>
<p>此终端节点将用于取回您账户的相关信息</p>

<p><strong>定义</strong></p>

<p><code>GET</code> https://api.testwyre.com/v2/account</p>

<p>查询<code>availableBalance(可用余额)</code>来获取账户余额信息，此项将返回按照目的币种汇率换算后可转账金额。</p>

<table><thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>ID</td>
<td>账户内部识别号</td>
</tr>
<tr>
<td>createdAt</td>
<td>账户创建时间</td>
</tr>
<tr>
<td>updatedAt</td>
<td>账户最后更新时间</td>
</tr>
<tr>
<td>loginAt</td>
<td>账户最后登录时间</td>
</tr>
<tr>
<td>rank</td>
<td>账户排名，主要用于识别账户权限，例如购买外汇上限</td>
</tr>
<tr>
<td>profile</td>
<td>账户信息，一组用户有权限更改的字段</td>
</tr>
<tr>
<td>paymentMethods</td>
<td>账户收款方式</td>
</tr>
<tr>
<td>identities</td>
<td>一组关联账户个人身份信息的数组，如电话邮箱等，此处包含的信息需与账户创建验证时一致</td>
</tr>
<tr>
<td>depositAddresses</td>
<td>账户下储存货币地址</td>
</tr>
<tr>
<td>totalBalances</td>
<td>账户下所有余额，包括处理中和可用余额</td>
</tr>
<tr>
<td>availableBalances</td>
<td>账户下目前可用余额，如果需要查询账户内有多少余额可供提现操作，请查询此项</td>
</tr>
<tr>
<td>email</td>
<td>绑定的邮箱</td>
</tr>
<tr>
<td>cellphone</td>
<td>绑定的手机号</td>
</tr>
</tbody></table>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
  "id": "121pd02kt0rnb24nclsg4bglanimurqp",
  "createdAt": 1404177262332,
  "updatedAt": 1404177262332,
  "loginAt": 1404177262332,
  "rank": 0,
  "profile": {
    "firstName": "",
    "lastName": "",
    "locale": "EN_us",
    "address": {
      "street1": null,
      "street2": null,
      "city": null,
      "state": null,
      "postalCode": null,
      "country": "USA"
    },
    "businessAccount": true,
    "taxId": null,
    "doingBusinessAs": null,
    "website": null,
    "dateOfBirth": 1404177262332,
    "notifyEmail": true,
    "notifyCellphone": true,
    "notifyApnsDevice": true,
    "mfaRequiredForPwChange": false,
    "mfaRequiredForDcPurchase": false,
    "mfaRequiredForSendingFunds": false,
    "authyPhoneNumber": null
  },
  "paymentMethods": [],
  "identities": [
    {
      "srn": "email:richard@apiepi.com",
      "createdAt": 1404177262332,
      "verifiedAt": 1404177262332
    }
  ],
  "depositAddresses": {
    "BTC": "1H9K67J9NcYtzmFGojR9cgM5ybxEddySwu"
  },
  "totalBalances": {
    "USD": 11.8934023
  },
  "availableBalances": {
    "USD": 10.8934023,
  },
  "email": "richard@apiepi.com",
  "cellphone": "+12312313112"
}
</pre>
<h1 id='88f0e7b5b9'>子钱包</h1>
<p>epiapi使用子钱包来指代每个商户的独立收款账户。在使用VBA进行跨境收款时，所有子钱包创建类型均为<code>type=VBA</code>。以下图表显示了一组典型的收款流程。</p>

<p><img src="images/Flow-Zh.png" alt="Flow-Zh.png" /></p>
<h2 id='5aea6fa68a'>创建子钱包</h2><pre class="highlight plaintext"><code>curl -v -XPOST 'https://api.testwyre.com/v2/wallets' \
  -H "Content-Type: application/json" \
  -H "X-Api-Key: {api-key}" \
  -H "X-Api-Signature: {signature}" \
  -d '{"type":"ENTERPRISE","name":"{your-unique-identifier}",
  "callbackUrl":"https://your.website.io/callback",
  "notes":"Notes about the sub account"}'
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">javax.crypto.Mac</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.DataOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.Integer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.String</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.StringBuffer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.HttpURLConnection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URL</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">accountId</span> <span class="o">=</span> <span class="s">"k3f48j0rb2rp65c0sdog67vi43u80jas"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">apiKey</span> <span class="o">=</span> <span class="s">"fll36l3t35udalcqlh4ng6bm4qpbgher"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">secretKey</span> <span class="o">=</span> <span class="s">"tr3epinbk3maist0n3ijk18bm6dikrq6"</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.testwyre.com/v2/wallets"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="s">"POST"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">excuteWyereRequest</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">secretKey</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
        <span class="s">"  \"type\":\"ENTERPRISE\","</span> <span class="o">+</span>
        <span class="s">"  \"name\":\"{your-unique-identifier}\","</span> <span class="o">+</span>
        <span class="s">"  \"callbackUrl\":\"https://your.website.io/callback\","</span> <span class="o">+</span>
        <span class="s">"  \"notes\":\"Notes about the user\","</span> <span class="o">+</span>
        <span class="s">"  \"verificationData\": {"</span> <span class="o">+</span>
        <span class="s">"      \"firstName\":\"{users-first-name}\","</span> <span class="o">+</span>
        <span class="s">"      \"middleName\":\"{users-middle-name}\","</span> <span class="o">+</span>
        <span class="s">"      \"lastName\":\"{users-last-name}\","</span> <span class="o">+</span>
        <span class="s">"      \"ssn\":\"0000\","</span> <span class="o">+</span>
        <span class="s">"      \"passport\":\"123456\","</span> <span class="o">+</span>
        <span class="s">"      \"birthDay\":\"1\","</span> <span class="o">+</span>
        <span class="s">"      \"birthMonth\":\"1\","</span> <span class="o">+</span>
        <span class="s">"      \"birthYear\":\"1970\","</span> <span class="o">+</span>
        <span class="s">"      \"phoneNumber\":\"+15555555555\","</span> <span class="o">+</span>
        <span class="s">"      \"address\": {"</span> <span class="o">+</span>
        <span class="s">"          \"street1\":\"1 Market Street\","</span> <span class="o">+</span>
        <span class="s">"          \"street2\":\"Suit 420\","</span> <span class="o">+</span>
        <span class="s">"          \"city\":\"San Francisco\","</span> <span class="o">+</span>
        <span class="s">"          \"state\":\"CA\","</span> <span class="o">+</span>
        <span class="s">"          \"postalCode\":\"94105\","</span> <span class="o">+</span>
        <span class="s">"          \"country\":\"US\""</span> <span class="o">+</span>
        <span class="s">"      }"</span> <span class="o">+</span>
        <span class="s">"  }"</span> <span class="o">+</span>
        <span class="s">"}"</span><span class="o">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">excuteWyreRequest</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">data</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">secretKey</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">excuteWyreRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">targetURL</span><span class="o">,</span> <span class="n">String</span> <span class="n">requestBody</span><span class="o">,</span> <span class="n">String</span> <span class="n">method</span><span class="o">,</span> <span class="n">String</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">secretKey</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">URL</span> <span class="n">url</span><span class="o">;</span>
    <span class="n">HttpURLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>

      <span class="n">targetURL</span> <span class="o">+=</span> <span class="o">((</span><span class="n">targetURL</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s">"?"</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">)?</span><span class="s">"&amp;"</span><span class="o">:</span><span class="s">"?"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"timestamp="</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

      <span class="c1">//Create connection</span>
      <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">targetURL</span><span class="o">);</span>
      <span class="n">connection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span><span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">connection</span><span class="o">.</span><span class="na">getRequestMethod</span><span class="o">());</span>

      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">);</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">requestBody</span><span class="o">.</span><span class="na">getBytes</span><span class="o">().</span><span class="na">length</span><span class="o">));</span>

      <span class="c1">//Specify API v2</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Version"</span><span class="o">,</span><span class="s">"2"</span><span class="o">);</span>

      <span class="c1">// Provide API key and signature</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Key"</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">);</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Signature"</span><span class="o">,</span><span class="n">computeSignature</span><span class="o">(</span><span class="n">secretKey</span><span class="o">,</span><span class="n">targetURL</span><span class="o">,</span><span class="n">requestBody</span><span class="o">));</span>

      <span class="c1">//Send request</span>
      <span class="k">if</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">setDoOutput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>

        <span class="n">DataOutputStream</span> <span class="n">wr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataOutputStream</span><span class="o">(</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>

        <span class="n">wr</span><span class="o">.</span><span class="na">writeBytes</span><span class="o">(</span><span class="n">requestBody</span><span class="o">);</span>
        <span class="n">wr</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">wr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span>

      <span class="c1">//Get Response</span>
      <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
      <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">));</span>
      <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
      <span class="n">StringBuffer</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
      <span class="k">while</span><span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">'\r'</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">rd</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>

      <span class="k">if</span><span class="o">(</span><span class="n">connection</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">computeSignature</span><span class="o">(</span><span class="n">String</span> <span class="n">secretKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">reqData</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">reqData</span><span class="o">;</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Mac</span> <span class="n">sha256Hmac</span> <span class="o">=</span> <span class="n">Mac</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"HmacSHA256"</span><span class="o">);</span>
      <span class="n">SecretKeySpec</span> <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecretKeySpec</span><span class="o">(</span><span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="s">"HmacSHA256"</span><span class="o">);</span>
      <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>

      <span class="kt">byte</span><span class="o">[]</span> <span class="n">macData</span> <span class="o">=</span> <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

      <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span> <span class="n">element</span> <span class="o">:</span> <span class="n">macData</span><span class="o">){</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">((</span><span class="n">element</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="o">)</span> <span class="o">+</span> <span class="mh">0x100</span><span class="o">,</span> <span class="mi">16</span><span class="o">).</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c">#dependencies:</span>
<span class="c">#python3</span>
<span class="c">#pip3 install requests</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">request</span>

<span class="k">class</span> <span class="nc">MassPay_API</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_id</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_id</span> <span class="o">=</span> <span class="n">account_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="s">'https://api.testwyre.com/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">api_version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span> <span class="o">=</span> <span class="n">api_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span> <span class="o">=</span> <span class="n">api_secret</span>

    <span class="c">#authentication decorator. May raise ValueError if no json content is returned</span>
    <span class="k">def</span> <span class="nf">authenticate_request</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s">'?timestamp={}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="n">bodyJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="o">!=</span> <span class="s">''</span> <span class="k">else</span> <span class="s">''</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'application/json'</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Version'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Key'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Signature'</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">bodyJson</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="s">'SHA256'</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Signature'</span><span class="p">])</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="o">!=</span> <span class="s">''</span> <span class="k">else</span> <span class="bp">None</span><span class="p">),</span> <span class="n">json</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c">#Wyre will always try to give an err body</span>
                <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">wrap</span>

    <span class="nd">@authenticate_request</span>
    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">callbackUrl</span><span class="p">,</span> <span class="n">notes</span><span class="p">,</span> <span class="n">verificationData</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">+</span> <span class="s">'/wallets'</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">'POST'</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:</span><span class="n">name</span><span class="p">,</span>
                <span class="s">'verificationData'</span><span class="p">:</span><span class="n">verificationData</span><span class="p">,</span>
                <span class="s">'type'</span><span class="p">:</span><span class="s">'ENTERPRISE'</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">callbackUrl</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">"callbackUrl"</span><span class="p">]</span> <span class="o">=</span> <span class="n">callbackUrl</span>
        <span class="k">if</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">'notes'</span><span class="p">]</span> <span class="o">=</span> <span class="n">notes</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span>

<span class="c">#USAGE Example</span>
<span class="n">account_id</span> <span class="o">=</span> <span class="s">"YOUR_ACCOUNT_ID_HERE"</span> <span class="c">#optional</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="s">"YOUR_API_KEY_HERE"</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="s">"YOUR_SECRET_KEY_HERE"</span>
<span class="n">api_version</span> <span class="o">=</span> <span class="s">"2"</span>

<span class="c">#create Wyre MassPay API object</span>
<span class="n">Wyre</span> <span class="o">=</span> <span class="n">MassPay_API</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">)</span>

<span class="c">#create user and print result</span>
<span class="n">http_code</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Wyre</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
                                <span class="s">"{your-unique-identifier}"</span><span class="p">,</span>
                                <span class="s">"https://your.website.io/callback"</span><span class="p">,</span>
                                <span class="bp">None</span><span class="p">,</span> <span class="c">#notes</span>
                                <span class="p">{</span>
                                  <span class="s">"firstName"</span><span class="p">:</span> <span class="s">"{users-first-name}"</span><span class="p">,</span>
                                  <span class="s">"middleName"</span><span class="p">:</span> <span class="s">"{users-middle-name}"</span><span class="p">,</span>
                                  <span class="s">"lastName"</span><span class="p">:</span> <span class="s">"{users-last-name}"</span><span class="p">,</span>
                                  <span class="s">"ssn"</span><span class="p">:</span> <span class="s">"0000"</span><span class="p">,</span>
                                  <span class="s">"passport"</span><span class="p">:</span> <span class="s">"123456"</span><span class="p">,</span>
                                  <span class="s">"birthDay"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span>
                                  <span class="s">"birthMonth"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span>
                                  <span class="s">"birthYear"</span><span class="p">:</span> <span class="s">"1970"</span><span class="p">,</span>
                                  <span class="s">"phoneNumber"</span><span class="p">:</span> <span class="s">"+15555555555"</span><span class="p">,</span>
                                  <span class="s">"address"</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s">"street1"</span><span class="p">:</span><span class="s">"1 Market Street"</span><span class="p">,</span>
                                    <span class="s">"street2"</span><span class="p">:</span><span class="s">"Suite 420"</span><span class="p">,</span>
                                    <span class="s">"city"</span><span class="p">:</span><span class="s">"San Francisco"</span><span class="p">,</span>
                                    <span class="s">"state"</span><span class="p">:</span><span class="s">"CA"</span><span class="p">,</span>
                                    <span class="s">"postalCode"</span><span class="p">:</span><span class="s">"94105"</span><span class="p">,</span>
                                    <span class="s">"country"</span><span class="p">:</span><span class="s">"US"</span>
                                  <span class="p">}</span>
                                <span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">users_srn</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">'srn'</span><span class="p">]</span> <span class="c">#grab our srn identifier for the user</span>
<span class="s">'''

'''</span><span class="n">php</span>
<span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>
    <span class="n">function</span> <span class="n">make_authenticated_request</span><span class="p">(</span><span class="err">$</span><span class="n">endpoint</span><span class="p">,</span> <span class="err">$</span><span class="n">method</span><span class="p">,</span> <span class="err">$</span><span class="n">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">$</span><span class="n">url</span> <span class="o">=</span> <span class="s">'https://api.testwyre.com'</span><span class="p">;</span>
        <span class="err">$</span><span class="n">api_key</span> <span class="o">=</span> <span class="s">"bh405n7stsuo5ut30iftrsl71b4iqjnv"</span><span class="p">;</span>
        <span class="err">$</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s">"a19cvrchgja82urvn47kirrlrrb7stgg"</span><span class="p">;</span>

        <span class="err">$</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">microtime</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
        <span class="err">$</span><span class="n">request_url</span> <span class="o">=</span> <span class="err">$</span><span class="n">url</span> <span class="o">.</span> <span class="err">$</span><span class="n">endpoint</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">strpos</span><span class="p">(</span><span class="err">$</span><span class="n">request_url</span><span class="p">,</span><span class="s">"?"</span><span class="p">))</span>
            <span class="err">$</span><span class="n">request_url</span> <span class="o">.=</span> <span class="s">'&amp;timestamp='</span> <span class="o">.</span> <span class="err">$</span><span class="n">timestamp</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="err">$</span><span class="n">request_url</span> <span class="o">.=</span> <span class="s">'?timestamp='</span> <span class="o">.</span> <span class="err">$</span><span class="n">timestamp</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="n">empty</span><span class="p">(</span><span class="err">$</span><span class="n">body</span><span class="p">))</span>
            <span class="err">$</span><span class="n">body</span> <span class="o">=</span> <span class="n">json_encode</span><span class="p">(</span><span class="err">$</span><span class="n">body</span><span class="p">,</span> <span class="n">JSON_FORCE_OBJECT</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="err">$</span><span class="n">body</span> <span class="o">=</span> <span class="s">''</span><span class="p">;</span>

        <span class="err">$</span><span class="n">headers</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
            <span class="s">"Content-Type: application/json"</span><span class="p">,</span>
            <span class="s">"X-Api-Key: "</span><span class="o">.</span> <span class="err">$</span><span class="n">api_key</span><span class="p">,</span>
            <span class="s">"X-Api-Signature: "</span><span class="o">.</span> <span class="n">calc_auth_sig_hash</span><span class="p">(</span><span class="err">$</span><span class="n">secret_key</span><span class="p">,</span> <span class="err">$</span><span class="n">request_url</span> <span class="o">.</span> <span class="err">$</span><span class="n">body</span><span class="p">),</span>
            <span class="s">"X-Api-Version: 2"</span>
        <span class="p">);</span>
        <span class="err">$</span><span class="n">curl</span> <span class="o">=</span> <span class="n">curl_init</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="err">$</span><span class="n">method</span><span class="o">==</span><span class="s">"POST"</span><span class="p">){</span>
          <span class="err">$</span><span class="n">options</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
            <span class="n">CURLOPT_URL</span>             <span class="o">=&gt;</span> <span class="err">$</span><span class="n">request_url</span><span class="p">,</span>
            <span class="n">CURLOPT_POST</span>            <span class="o">=&gt;</span>  <span class="n">true</span><span class="p">,</span>
            <span class="n">CURLOPT_POSTFIELDS</span>      <span class="o">=&gt;</span> <span class="err">$</span><span class="n">body</span><span class="p">,</span>
            <span class="n">CURLOPT_RETURNTRANSFER</span>  <span class="o">=&gt;</span> <span class="n">true</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
          <span class="err">$</span><span class="n">options</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
            <span class="n">CURLOPT_URL</span>             <span class="o">=&gt;</span> <span class="err">$</span><span class="n">request_url</span><span class="p">,</span>
            <span class="n">CURLOPT_RETURNTRANSFER</span>  <span class="o">=&gt;</span> <span class="n">true</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">curl_setopt_array</span><span class="p">(</span><span class="err">$</span><span class="n">curl</span><span class="p">,</span> <span class="err">$</span><span class="n">options</span><span class="p">);</span>
        <span class="n">curl_setopt</span><span class="p">(</span><span class="err">$</span><span class="n">curl</span><span class="p">,</span> <span class="n">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="err">$</span><span class="n">headers</span><span class="p">);</span>
        <span class="err">$</span><span class="n">result</span> <span class="o">=</span> <span class="n">curl_exec</span><span class="p">(</span><span class="err">$</span><span class="n">curl</span><span class="p">);</span>
        <span class="n">curl_close</span><span class="p">(</span><span class="err">$</span><span class="n">curl</span><span class="p">);</span>
        <span class="n">var_dump</span><span class="p">(</span><span class="err">$</span><span class="n">result</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">json_decode</span><span class="p">(</span><span class="err">$</span><span class="n">result</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">calc_auth_sig_hash</span><span class="p">(</span><span class="err">$</span><span class="n">seckey</span><span class="p">,</span> <span class="err">$</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">$</span><span class="nb">hash</span> <span class="o">=</span> <span class="n">hash_hmac</span><span class="p">(</span><span class="s">'sha256'</span><span class="p">,</span> <span class="err">$</span><span class="n">val</span><span class="p">,</span> <span class="err">$</span><span class="n">seckey</span><span class="p">);</span>
        <span class="k">return</span> <span class="err">$</span><span class="nb">hash</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="err">$</span><span class="n">userData</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
      <span class="s">"type"</span><span class="o">=&gt;</span><span class="s">"ENTERPRISE"</span><span class="p">,</span>
      <span class="s">"name"</span><span class="o">=&gt;</span><span class="s">"{your-unique-identifier}"</span><span class="p">,</span>
      <span class="s">"callbackUrl"</span><span class="o">=&gt;</span><span class="s">"https://your.website.io/callback"</span><span class="p">,</span>
      <span class="s">"notes"</span><span class="o">=&gt;</span> <span class="s">"Notes about the user"</span><span class="p">,</span>
      <span class="s">"verificationData"</span><span class="o">=&gt;</span> <span class="n">array</span><span class="p">(</span>
          <span class="s">"firstName"</span><span class="o">=&gt;</span> <span class="s">"{users-first-name}"</span><span class="p">,</span>
          <span class="s">"middleName"</span><span class="o">=&gt;</span> <span class="s">"{users-middle-name}"</span><span class="p">,</span>
          <span class="s">"lastName"</span><span class="o">=&gt;</span> <span class="s">"{users-last-name}"</span><span class="p">,</span>
          <span class="s">"ssn"</span><span class="o">=&gt;</span> <span class="s">"0000"</span><span class="p">,</span>
          <span class="s">"passport"</span><span class="o">=&gt;</span> <span class="s">"12345"</span><span class="p">,</span>
          <span class="s">"birthDay"</span><span class="o">=&gt;</span> <span class="s">"1"</span><span class="p">,</span>
          <span class="s">"birthMonth"</span><span class="o">=&gt;</span> <span class="s">"1"</span><span class="p">,</span>
          <span class="s">"birthYear"</span><span class="o">=&gt;</span> <span class="s">"1970"</span><span class="p">,</span>
          <span class="s">"phoneNumber"</span><span class="o">=&gt;</span> <span class="s">"+15555555555"</span><span class="p">,</span>
          <span class="s">"address"</span><span class="o">=&gt;</span> <span class="n">array</span><span class="p">(</span>
            <span class="s">"street1"</span><span class="p">:</span><span class="s">"1 Market Street"</span><span class="p">,</span>
            <span class="s">"street2"</span><span class="p">:</span><span class="s">"Suite 420"</span><span class="p">,</span>
            <span class="s">"city"</span><span class="p">:</span><span class="s">"San Francisco"</span><span class="p">,</span>
            <span class="s">"state"</span><span class="p">:</span><span class="s">"CA"</span><span class="p">,</span>
            <span class="s">"postalCode"</span><span class="p">:</span><span class="s">"94105"</span><span class="p">,</span>
            <span class="s">"country"</span><span class="p">:</span><span class="s">"US"</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">);</span>
    <span class="n">echo</span> <span class="n">make_authenticated_request</span><span class="p">(</span><span class="s">"/wallets"</span><span class="p">,</span> <span class="s">"POST"</span><span class="p">,</span> <span class="err">$</span><span class="n">userData</span><span class="p">);</span>
<span class="err">?</span><span class="o">&gt;</span>
</code></pre>
<p><strong>定义</strong></p>

<p><code>POST</code> https://api.testwyre.com/v2/wallets</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否需要</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>用户名</td>
<td>yes</td>
</tr>
<tr>
<td>callbackUrl</td>
<td>string</td>
<td>钱包数据或信息更新时将通过callbackUrl发送回传</td>
<td>no</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>创建钱包类型，默认为 <code>DEFAULT</code></td>
<td>no</td>
</tr>
<tr>
<td>notes</td>
<td>string</td>
<td>关于此用户的附注</td>
<td>no</td>
</tr>
</tbody></table>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
  "name" : "{your-unique-identifier}",
  "id" : "WA-AYBNA3lBiWAM4l3",
  "depositAddresses" : {
    "BTC" : "2ShL7kzSNNxedit6hC2fjSQhVcAucTeS1m7"
  },
  "totalBalances" : {
    "BTC" : 0
  },
  "availableBalances" : {
    "BTC" : 0
  },
  "srn" : "wallet:AYBNA3lBiWAM4l3",
  "balances" : {
    "BTC" : 0
  },
  "callbackUrl" : "https://your.website.io/callback",
  "notes" : "Notes about the user"
}
</pre>

<p><br></p>
<h2 id='ca23b97e7e'>创建多个子钱包</h2><pre class="highlight plaintext"><code>
curl -XPOST 'https://api.testwyre.com/v2/wallets/batch?pretty' \
-H 'Content-Type:application/json' \
-d '{
  "wallets":[
    {"name":"walletOne"},
    {"name":"walletTwo"},
    {"name":"walletThree"}
  ]
}'
</code></pre>
<p>此终端节点允许通过一个请求创建多个子钱包（每用户一个）。</p>

<p><strong>定义</strong></p>

<p><code>POST</code> https://api.testwyre.com/v2/wallets/batch</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否需要</th>
</tr>
</thead><tbody>
<tr>
<td>wallets</td>
<td>array</td>
<td>每个子钱包对象的数组</td>
<td>yes</td>
</tr>
</tbody></table>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
  "name" : "walletOne",
  "id" : "AxVA57edP0H33x3",
  "notes" : null,
  "srn" : "wallet:AxVA57edP0H33x3",
  "callbackUrl" : null,
  "verificationData" : null,
  "depositAddresses" : {
    "BTC" : "2ShKKFb9gEP5uvRXtMbs7ykJAMPgoSSnSWB"
  },
  "totalBalances" : {
    "BTC" : 0
  },
  "availableBalances" : {
    "BTC" : 0
  },
  "balances" : {
    "BTC" : 0
  }
}, {
  "name" : "walletTwo",
  "id" : "AtEhoXje3C1V5zq",
  "notes" : null,
  "srn" : "wallet:AtEhoXje3C1V5zq",
  "callbackUrl" : null,
  "verificationData" : null,
  "depositAddresses" : {
    "BTC" : "2ShKndBJNHvzABhBzLxvfzzD2vt64C36dPc"
  },
  "totalBalances" : {
    "BTC" : 0
  },
  "availableBalances" : {
    "BTC" : 0
  },
  "balances" : {
    "BTC" : 0
  }
}, {
  "name" : "walletThree",
  "id" : "U07tSKMvofeMmx0",
  "notes" : null,
  "srn" : "wallet:U07tSKMvofeMmx0",
  "callbackUrl" : null,
  "verificationData" : null,
  "depositAddresses" : {
    "BTC" : "2ShJsBPUb4HrNtgaNZk3YQSi2ynpZ5YY7sT"
  },
  "totalBalances" : {
    "BTC" : 0

  },
  "availableBalances" : {
    "BTC" : 0
  },
  "balances" : {
    "BTC" : 0
  }
}
</pre>
<h2 id='0b81bd026f'>查询子钱包</h2>
<p><strong>通过user ID查询子钱包：</strong></p>
<pre class="highlight plaintext"><code>curl -v -XGET 'https://api.testwyre.com/v2/wallet/{wallet-id}' \
  -H "X-Api-Key: {api-key}" \
  -H "X-Api-Signature: {signature}" \
</code></pre>
<p><strong>通过用户名查询子钱包：</strong></p>
<pre class="highlight plaintext"><code>curl -v -XGET 'https://api.testwyre.com/v2/wallet' \
  -H "X-Api-Key: {api-key}" \
  -H "X-Api-Signature: {signature}" \
  -d name={your-identifier}
</code></pre>
<p>此终端节点允许通过id或名字查询子钱包余额。</p>

<p><strong>定义</strong></p>

<p><code>GET</code> https://api.testwyre.com/v2/wallet/{walletId}</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否需要</th>
</tr>
</thead><tbody>
<tr>
<td>walletId</td>
<td>string</td>
<td>子钱包所属用户id</td>
<td>yes</td>
</tr>
</tbody></table>

<p><br>
<strong>定义</strong></p>

<p><code>GET</code> https://api.testwyre.com/v2/wallet/</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否需要</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>子钱包所属用户名</td>
<td>yes</td>
</tr>
</tbody></table>

<p><br>
<strong>Results Format</strong></p>

<pre class="center-column">
{
   "owner": "account:[account-ID]",
   "callbackUrl": null,
   "depositAddresses": {
       "BTC": "1FNAkNVt3gXdS3PZ1tDvetbcafKPsJPQTG"
   },
   "totalBalances": {
       "USD": 4.96
   },
   "availableBalances": {
       "USD": 4.96
   },
   "verificationData": null,
   "balances": {
       "USD": 4.96
   },
   "srn": "wallet:[Wallet-ID]",
   "createdAt": 1497861843000,
   "notes": "test1",
   "name": "richard",
   "id": "[Wallet-ID]"
}
</pre>

<p><br></p>
<h2 id='2436cc0e95'>编辑钱包</h2><pre class="highlight plaintext"><code>curl -v -XPOST 'https://api.testwyre.com/v2/wallet/{wallet-id}/update' \
  -H "Content-Type: application/json" \
  -H "X-Api-Key: {api-key}" \
  -H "X-Api-Signature: {signature}" \
  -d '{"name":"{your-unique-identifier}","notes":"Updated notes about the sub account"}'
</code></pre><pre class="highlight python tab-python"><code><span class="c">#dependencies:</span>
<span class="c">#python3</span>
<span class="c">#pip3 install requests</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">request</span>

<span class="k">class</span> <span class="nc">MassPay_API</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_id</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_id</span> <span class="o">=</span> <span class="n">account_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="s">'https://api.testwyre.com/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">api_version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span> <span class="o">=</span> <span class="n">api_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span> <span class="o">=</span> <span class="n">api_secret</span>

    <span class="c">#authentication decorator. May raise ValueError if no json content is returned</span>
    <span class="k">def</span> <span class="nf">authenticate_request</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s">'?timestamp={}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="n">bodyJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="o">!=</span> <span class="s">''</span> <span class="k">else</span> <span class="s">''</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'application/json'</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Version'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Key'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Signature'</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_secret</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">bodyJson</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="s">'SHA256'</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">'X-Api-Signature'</span><span class="p">])</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="o">!=</span> <span class="s">''</span> <span class="k">else</span> <span class="bp">None</span><span class="p">),</span> <span class="n">json</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c">#Wyre will always try to give an err body</span>
                <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">wrap</span>

    <span class="nd">@authenticate_request</span>
    <span class="k">def</span> <span class="nf">update_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">walletId</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">callbackUrl</span><span class="p">,</span> <span class="n">notes</span><span class="p">,</span> <span class="n">verificationData</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">+</span> <span class="s">'/wallet/'</span> <span class="o">+</span> <span class="n">walletId</span> <span class="o">+</span> <span class="s">'/update'</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">'POST'</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:</span><span class="n">name</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">callbackUrl</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">"callbackUrl"</span><span class="p">]</span> <span class="o">=</span> <span class="n">callbackUrl</span>
        <span class="k">if</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">'notes'</span><span class="p">]</span> <span class="o">=</span> <span class="n">notes</span>
        <span class="k">if</span> <span class="n">verificationData</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s">'verificationData'</span><span class="p">]</span> <span class="o">=</span> <span class="n">verificationData</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span>

<span class="c">#USAGE Example</span>
<span class="n">account_id</span> <span class="o">=</span> <span class="s">"YOUR_ACCOUNT_ID_HERE"</span> <span class="c">#optional</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="s">"YOUR_API_KEY_HERE"</span>
<span class="n">secret_key</span> <span class="o">=</span> <span class="s">"YOUR_SECRET_KEY_HERE"</span>
<span class="n">api_version</span> <span class="o">=</span> <span class="s">"2"</span>

<span class="c">#create Wyre MassPay API object</span>
<span class="n">Wyre</span> <span class="o">=</span> <span class="n">MassPay_API</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">)</span>

<span class="c">#create user and print result</span>
<span class="n">http_code</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Wyre</span><span class="o">.</span><span class="n">update_user</span><span class="p">(</span>
                                <span class="s">"{wallet-id}"</span><span class="p">,</span>
                                <span class="s">"{your-unique-identifier}"</span><span class="p">,</span>
                                <span class="bp">None</span><span class="p">,</span> <span class="c">#callbackUrl</span>
                                <span class="s">"Updated notes for user"</span><span class="p">,</span>
                                <span class="bp">None</span> <span class="c">#verification data</span>
                                <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">users_srn</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">'srn'</span><span class="p">]</span> <span class="c">#grab our srn identifier for the user</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">javax.crypto.Mac</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.DataOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.Integer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.String</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.StringBuffer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.HttpURLConnection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URL</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">accountId</span> <span class="o">=</span> <span class="s">"k3f48j0rb2rp65c0sdog67vi43u80jas"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">apiKey</span> <span class="o">=</span> <span class="s">"fll36l3t35udalcqlh4ng6bm4qpbgher"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">secretKey</span> <span class="o">=</span> <span class="s">"tr3epinbk3maist0n3ijk18bm6dikrq6"</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">walletId</span> <span class="o">=</span> <span class="s">"{wallet-id}"</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.testwyre.com/v2/wallet/"</span><span class="o">+</span> <span class="n">walletId</span> <span class="o">+</span><span class="s">"/update"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="s">"POST"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">excuteWyreRequest</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">secretKey</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
        <span class="s">"  \"name\":\"{your-unique-identifier}\","</span> <span class="o">+</span>
        <span class="s">"  \"notes\":\"Updated notes about the user\""</span> <span class="o">+</span>
        <span class="s">"}"</span><span class="o">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">excuteWyreRequest</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">data</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">secretKey</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">excuteWyreRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">targetURL</span><span class="o">,</span> <span class="n">String</span> <span class="n">requestBody</span><span class="o">,</span> <span class="n">String</span> <span class="n">method</span><span class="o">,</span> <span class="n">String</span> <span class="n">apiKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">secretKey</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">URL</span> <span class="n">url</span><span class="o">;</span>
    <span class="n">HttpURLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>

      <span class="n">targetURL</span> <span class="o">+=</span> <span class="o">((</span><span class="n">targetURL</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s">"?"</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">)?</span><span class="s">"&amp;"</span><span class="o">:</span><span class="s">"?"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"timestamp="</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

      <span class="c1">//Create connection</span>
      <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">targetURL</span><span class="o">);</span>
      <span class="n">connection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span><span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">connection</span><span class="o">.</span><span class="na">getRequestMethod</span><span class="o">());</span>

      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">);</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">requestBody</span><span class="o">.</span><span class="na">getBytes</span><span class="o">().</span><span class="na">length</span><span class="o">));</span>

      <span class="c1">//Specify API v2</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Version"</span><span class="o">,</span><span class="s">"2"</span><span class="o">);</span>

      <span class="c1">// Provide API key and signature</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Key"</span><span class="o">,</span> <span class="n">apiKey</span><span class="o">);</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">"X-Api-Signature"</span><span class="o">,</span><span class="n">computeSignature</span><span class="o">(</span><span class="n">secretKey</span><span class="o">,</span><span class="n">targetURL</span><span class="o">,</span><span class="n">requestBody</span><span class="o">));</span>

      <span class="c1">//Send request</span>
      <span class="k">if</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">setDoOutput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>

        <span class="n">DataOutputStream</span> <span class="n">wr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataOutputStream</span><span class="o">(</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>

        <span class="n">wr</span><span class="o">.</span><span class="na">writeBytes</span><span class="o">(</span><span class="n">requestBody</span><span class="o">);</span>
        <span class="n">wr</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">wr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span>

      <span class="c1">//Get Response</span>
      <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
      <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">));</span>
      <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
      <span class="n">StringBuffer</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
      <span class="k">while</span><span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">'\r'</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">rd</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>

      <span class="k">if</span><span class="o">(</span><span class="n">connection</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">computeSignature</span><span class="o">(</span><span class="n">String</span> <span class="n">secretKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">reqData</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="n">reqData</span><span class="o">;</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Mac</span> <span class="n">sha256Hmac</span> <span class="o">=</span> <span class="n">Mac</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"HmacSHA256"</span><span class="o">);</span>
      <span class="n">SecretKeySpec</span> <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecretKeySpec</span><span class="o">(</span><span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="s">"HmacSHA256"</span><span class="o">);</span>
      <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>

      <span class="kt">byte</span><span class="o">[]</span> <span class="n">macData</span> <span class="o">=</span> <span class="n">sha256Hmac</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

      <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span> <span class="n">element</span> <span class="o">:</span> <span class="n">macData</span><span class="o">){</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">((</span><span class="n">element</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="o">)</span> <span class="o">+</span> <span class="mh">0x100</span><span class="o">,</span> <span class="mi">16</span><span class="o">).</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>此终端节点允许更新母账户下子钱包的信息。</p>

<p><strong>定义</strong></p>

<p><code>POST</code> https://api.testwyre.com/v2/wallet/{walletId}</p>
<h2 id='f3cd4d2aa7'>删除钱包</h2><pre class="highlight plaintext"><code>
curl -v -XDELETE 'https://api.testwyre.com/v2/wallet/{wallet-id}' \
  -H "X-Api-Key: {api-key}" \
  -H "X-Api-Signature: {signature}"
</code></pre>
<p>此终端节点用于删除母账户下子钱包。请知悉出于合规考虑，子钱包的相关数据仍会储存在我们的系统后台。子钱包删除后，关联的收款虚拟银行账户也将被关闭，不能再用于收款。</p>

<p><strong>定义</strong></p>

<p><code>DELETE</code> https://api.testwyre.com/v2/wallet/{walletId}</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否需要</th>
</tr>
</thead><tbody>
<tr>
<td>walletId</td>
<td>string</td>
<td>子钱包id</td>
<td>yes</td>
</tr>
</tbody></table>
<h2 id='cc1fa66341'>列出子钱包</h2>
<p>此终端节点用于列出母账户下已创建的所有子钱包。</p>

<p><strong>定义</strong></p>

<p><code>GET</code> https://api.testwyre.com/v2/wallets</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否需要</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>string</td>
<td>返回记录数</td>
<td>yes</td>
</tr>
<tr>
<td>offset</td>
<td>string</td>
<td>跳过记录数</td>
<td>yes</td>
</tr>
</tbody></table>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
  "data": {
      "owner": "account:XAV3CRAC94P",
      "balances": {},
      "srn": "wallet:WA-XM4L3JMUQGF",
      "createdAt": 1508433396000,
      "callbackUrl": "https://shake.webscript.io/callback",
      "depositAddresses": {
        "BTC": "1Q9TqsVwuZf6bYqtxxjqdataXx81x3Q1h7"
      },
      "totalBalances": {},
      "availableBalances": {},
      "notes": "nope",
      "name": "Person A",
      "id": "WA-XM4L3JMUQGF"
     }
  }
</pre>
<h1 id='8e9ec9ac7d'>转账</h1><h2 id='45fa4e00db'>介绍</h2>
<p>转账是Epi API中最重要的操作之一，我们的转账API功能强大，非常灵活，除外部转账，内部的资金移动也同样支持，母账户管理、子钱包间交易等渠道皆可。除此之外，您可指定不同的来源和目的币种，资金将在后台自动完成处理。</p>

<p>任何在平台上的资金移动都被视为交易操作，所以过程中款项将会呈现不同的处理状态，直至操作完成，款项被转入您指定的收入方。</p>
<h2 id='f84e5af910'>创建转账</h2>
<p><strong>定义</strong></p>

<p><code>POST</code> https://api.testwyre.com/v2/transfer/</p>

<p>此终端节点用于创建一笔新转账。</p>

<pre class="center-column">
{  
   "source":"account:AC-123123123",
   "sourceCurrency":"USD",
   "sourceAmount":"5",
   "dest":"email:sam@testwyre.com",
   "destCurrency":"CNY",
   "message": ""
}
</pre>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否需要</th>
</tr>
</thead><tbody>
<tr>
<td>source</td>
<td>string</td>
<td>识别转出账户的系统资源名称</td>
<td>no</td>
</tr>
<tr>
<td>sourceAmount</td>
<td>double</td>
<td>来源币种转出金额，与 <code>sourceCurrency</code>成对. 只写 <code>sourceAmount</code> 或 <code>destAmount</code>，不要都写</td>
<td>yes</td>
</tr>
<tr>
<td>sourceCurrency</td>
<td>string</td>
<td>来源币种的ISO 3166-1三位字母代码</td>
<td>yes</td>
</tr>
<tr>
<td>dest</td>
<td>string</td>
<td>收入方的收款银行信息或子钱包信息，请留意此处手机号码默认为美国手机号，国际号码请加‘+’和国家码</td>
<td>yes</td>
</tr>
<tr>
<td>destAmount</td>
<td>double</td>
<td>目的币种收入金额，只写<code>sourceAmount</code> OR <code>destAmount</code>，不要都写</td>
<td>yes</td>
</tr>
<tr>
<td>destCurrency</td>
<td>string</td>
<td>目的币种的ISO 3166-1三位字母代码，来源币种可与目的币种相同或不同，不同时将自动进行兑换</td>
<td>yes</td>
</tr>
<tr>
<td>message</td>
<td>string</td>
<td>用户可见的附言，此处非必填</td>
<td>no</td>
</tr>
<tr>
<td>callbackUrl</td>
<td>string</td>
<td>状态返回时的回调url，此处非必填</td>
<td>no</td>
</tr>
<tr>
<td>autoConfirm</td>
<td>boolean</td>
<td>自动确认转账，此处非必填</td>
<td>no</td>
</tr>
<tr>
<td>customId</td>
<td>string</td>
<td>用户的内部识别号码或标签，必须唯一，否则转账将失败，此处非必填</td>
<td>no</td>
</tr>
<tr>
<td>amountIncludesFees</td>
<td>boolean</td>
<td>此处的值若为true，则默认填入的转出/收入金额包含了需扣除的手续费，不会再产生其他费用，此处非必填</td>
<td>no</td>
</tr>
<tr>
<td>preview</td>
<td>boolean</td>
<td>此处的值若为true，将会生成转账信息的预览，而不实际操作转账</td>
<td>no</td>
</tr>
<tr>
<td>muteMessages</td>
<td>boolean</td>
<td>此处的值若为true，将禁用邮件、信息等通知款项收入方</td>
<td>no</td>
</tr>
</tbody></table>

<p><br></p>

<p>转账创建后状态为UNCONFIRMED（未确认)有30秒的时间用来检查并<a href="#256bf99b14">确认请求</a>，过时无效。无效时请重新创建转账请求，然后确认，也可以设置<code>autoConfirm</code>的值为<code>true</code>来自动确认。</p>

<p>检查一笔转账请求时请注意以下几项：</p>

<p><code>exchangeRate</code> - 转账交易时的汇率，汇率将以来源货币为基准表示，如需转换为目的货币，用汇率乘以来源货币即可，此项包含epiapi扣除的手续费及按需产生的其他费用。</p>

<p><code>sourceAmount/destAmount</code> - 转出金额/收入金额，请仔细检查此处的金额是否符合预计转出/收入的款项金额，此处的值取决于<code>amountIncludesFees</code>参数。</p>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
    "id": "TF-VWGF3WW6JU4",
    "status": "PENDING",
    "failureReason": null,
    "language": "en",
    "createdAt": 1525196883000,
    "updatedAt": 1525196883000,
    "completedAt": 1525196884000,
    "cancelledAt": null,
    "expiresAt": 1525456083000,
    "owner": "account:AC-PJZEFT7JP6J",
    "source": "service:Fiat Credits",
    "dest": "wallet:WA-AFFGZJJ7X82",
    "sourceCurrency": "USD",
    "sourceAmount": 10,
    "destCurrency": "USD",
    "destAmount": 10,
    "exchangeRate": null,
    "message": null,
    "totalFees": 0,
    "fees": {
        "USD": 0
    },
    "customId": null,
    "reversingSubStatus": null,
    "reversalReason": null,
    "pendingSubStatus": null,
    "destName": "amandawallet",
    "sourceName": "Wyre",
    "blockchainTx": null,
    "statusHistories": [
        {
            "id": "HNUBAMZ4YQQ",
            "createdAt": 1525196884000,
            "statusDetail": "Initiating Transfer",
            "state": "INITIATED",
            "failedState": null
        },
        {
            "id": "V8L2MJNPF6D",
            "createdAt": 1525196884000,
            "statusDetail": "Transfer Pending",
            "state": "PENDING",
            "failedState": null
        }
    ]
}
</pre>
<h2 id='256bf99b14'>确认转账</h2>
<p>此终端节点用于确认款项划转。成功创建一笔转账后会受到200回调，此时有30秒时间来确认。请留意创建转账后生成的<code>transferId</code>，如果需要在<a href="#f84e5af910">创建转账</a>后自动确认，创建时请设置参数<code>autoConfirm</code>的值为‘true’。</p>

<p><strong>定义</strong></p>

<p><code>POST</code> https://api.testwyre.com/v2/transfer/transferId:/confirm</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>transferId</td>
<td>string</td>
<td>需确认的<code>transferId</code></td>
</tr>
</tbody></table>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
    "id": "TF-VWGF3WW6JU4",
    "status": "COMPLETED",
    "failureReason": null,
    "language": "en",
    "createdAt": 1525196883000,
    "updatedAt": 1525196883000,
    "completedAt": 1525196884000,
    "cancelledAt": null,
    "expiresAt": 1525456083000,
    "owner": "account:AC-PJZEFT7JP6J",
    "source": "service:Fiat Credits",
    "dest": "wallet:WA-AFFGZJJ7X82",
    "sourceCurrency": "USD",
    "sourceAmount": 10,
    "destCurrency": "USD",
    "destAmount": 10,
    "exchangeRate": null,
    "message": null,
    "totalFees": 0,
    "fees": {
        "USD": 0
    },
    "customId": null,
    "reversingSubStatus": null,
    "reversalReason": null,
    "pendingSubStatus": null,
    "destName": "amandawallet",
    "sourceName": "Wyre",
    "blockchainTx": null,
    "statusHistories": [
        {
            "id": "HNUBAMZ4YQQ",
            "createdAt": 1525196884000,
            "statusDetail": "Initiating Transfer",
            "state": "INITIATED",
            "failedState": null
        },
        {
            "id": "V8L2MJNPF6D",
            "createdAt": 1525196884000,
            "statusDetail": "Transfer Completed",
            "state": "COMPLETED",
            "failedState": null
        }
    ]
}
</pre>
<h2 id='4c4e13bb92'>查询转账</h2>
<p>此终端节点用于查询已创建的某笔转账的详细信息。</p>

<p><strong>定义</strong></p>

<p><code>GET</code> https://api.testwyre.com/v2/transfer?customId=</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>customId</td>
<td>string</td>
<td>创建转账时提供的识别号</td>
</tr>
</tbody></table>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
    "id": "TF-VWGF3WW6JU4",
    "status": "COMPLETED",
    "failureReason": null,
    "language": "en",
    "createdAt": 1525196883000,
    "updatedAt": 1525196883000,
    "completedAt": 1525196884000,
    "cancelledAt": null,
    "expiresAt": 1525456083000,
    "owner": "account:AC-PJZEFT7JP6J",
    "source": "service:Fiat Credits",
    "dest": "wallet:WA-AFFGZJJ7X82",
    "sourceCurrency": "USD",
    "sourceAmount": 10,
    "destCurrency": "USD",
    "destAmount": 10,
    "exchangeRate": null,
    "message": null,
    "totalFees": 0,
    "fees": {
        "USD": 0
    },
    "customId": null,
    "reversingSubStatus": null,
    "reversalReason": null,
    "pendingSubStatus": null,
    "destName": "amandawallet",
    "sourceName": "Wyre",
    "blockchainTx": null,
    "statusHistories": [
        {
            "id": "HNUBAMZ4YQQ",
            "createdAt": 1525196884000,
            "statusDetail": "Initiating Transfer",
            "state": "INITIATED",
            "failedState": null
        },
        {
            "id": "V8L2MJNPF6D",
            "createdAt": 1525196884000,
            "statusDetail": "Transfer Completed",
            "state": "COMPLETED",
            "failedState": null
        }
    ]
}
</pre>
<h2 id='1a3ddc077b'>转账状态</h2>
<p><strong>定义</strong></p>

<p><code>GET</code> https://api.testwyre.com/v2/transfer/:transferId</p>

<p><strong>参数</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>transferId</td>
<td>string</td>
<td>生成的transferId</td>
</tr>
</tbody></table>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
    "id": "TF-VWGF3WW6JU4",
    "status": "COMPLETED",
    "failureReason": null,
    "language": "en",
    "createdAt": 1525196883000,
    "updatedAt": 1525196883000,
    "completedAt": 1525196884000,
    "cancelledAt": null,
    "expiresAt": 1525456083000,
    "owner": "account:AC-PJZEFT7JP6J",
    "source": "service:Fiat Credits",
    "dest": "wallet:WA-AFFGZJJ7X82",
    "sourceCurrency": "USD",
    "sourceAmount": 10,
    "destCurrency": "USD",
    "destAmount": 10,
    "exchangeRate": null,
    "message": null,
    "totalFees": 0,
    "fees": {
        "USD": 0
    },
    "customId": null,
    "reversingSubStatus": null,
    "reversalReason": null,
    "pendingSubStatus": null,
    "destName": "amandawallet",
    "sourceName": "Wyre",
    "blockchainTx": null,
    "statusHistories": [
        {
            "id": "HNUBAMZ4YQQ",
            "createdAt": 1525196884000,
            "statusDetail": "Initiating Transfer",
            "state": "INITIATED",
            "failedState": null
        },
        {
            "id": "V8L2MJNPF6D",
            "createdAt": 1525196884000,
            "statusDetail": "Transfer Completed",
            "state": "COMPLETED",
            "failedState": null
        }
    ]
}
</pre>

<p><br></p>

<p>转账显示为PENDING(处理中)状态后，我们将开始转移款项至收款方。在此之后该笔转账会根据情况显示为COMPLETE(完成)或FAILED(失败)状态。</p>
<h2 id='c76b97433d'>回调</h2>
<p>我们提供一系列HTTP回调来方便您通知您的用户存款及转账状态。</p>

<p><strong>回调发出</strong></p>

<p>任何影响账户余额的操作都会导致发出回调，例如：</p>

<ul>
<li>处理中的入账</li>
<li>已确认的处理中转账</li>
<li>进行中的转账</li>
</ul>

<p>可能会出现一笔转账收到两次回调的情况，尤其是区块链上的相关操作，此时将在交易第一次被监测到和交易确认后分别收到两次回调。</p>

<p><strong>接收回调和重试</strong></p>

<p>您的系统应以HTTP 200响应回调请求，我们仅会尝试发送一次，此处将在稍后更新时转为自动重试。目前我们可以手动重新发送。</p>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
    "id": "TF-VWGF3WW6JU4",
    "status": "COMPLETED",
    "failureReason": null,
    "language": "en",
    "createdAt": 1525196883000,
    "updatedAt": 1525196883000,
    "completedAt": 1525196884000,
    "cancelledAt": null,
    "expiresAt": 1525456083000,
    "owner": "account:AC-PJZEFT7JP6J",
    "source": "service:Fiat Credits",
    "dest": "wallet:WA-AFFGZJJ7X82",
    "sourceCurrency": "USD",
    "sourceAmount": 10,
    "destCurrency": "USD",
    "destAmount": 10,
    "exchangeRate": null,
    "message": null,
    "totalFees": 0,
    "fees": {
        "USD": 0
    },
    "customId": null,
    "reversingSubStatus": null,
    "reversalReason": null,
    "pendingSubStatus": null,
    "destName": "amandawallet",
    "sourceName": "Wyre",
    "blockchainTx": null,
    "statusHistories": [
        {
            "id": "HNUBAMZ4YQQ",
            "createdAt": 1525196884000,
            "statusDetail": "Initiating Transfer",
            "state": "INITIATED",
            "failedState": null
        },
        {
            "id": "V8L2MJNPF6D",
            "createdAt": 1525196884000,
            "statusDetail": "Transfer Completed",
            "state": "COMPLETED",
            "failedState": null
        }
    ]
}
</pre>

<p><br></p>

<p>回调载荷为JSON格式，内容标示了触发该次回调的操作。</p>
<h1 id='d76738d4d9'>收款方式</h1><h2 id='099c6945dc'>添加银行信息</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"paymentMethodType"</span><span class="p">:</span><span class="s2">"INTERNATIONAL_TRANSFER"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"112 Brannan St"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryAddress2"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="err">//Optional</span><span class="w">
    </span><span class="s2">"beneficiaryCity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryState"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryPostal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"94108"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryPhoneNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+14102239203"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryDobDay"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryDobMonth"</span><span class="p">:</span><span class="s2">"12"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryDobYear"</span><span class="p">:</span><span class="s2">"1989"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"paymentType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"LOCAL_BANK_WIRE"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">LOCAL_BANK_WIRE</span><span class="w">
    </span><span class="s2">"firstNameOnAccount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Billy-Bob"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lastNameOnAccount"</span><span class="p">:</span><span class="s2">"Jones"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accountNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"routingNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accountType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CHECKING"</span><span class="p">,</span><span class="w"> </span><span class="err">//CHECKING</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">SAVINGS</span><span class="w">
    </span><span class="s2">"chargeablePM"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>这里需填写您账户汇出款项银行的信息。
我们将通过此字段来确认款项的汇出方，这将帮助我们了解款项的来源。</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"paymentMethodType"</span><span class="p">:</span><span class="s2">"INTERNATIONAL_TRANSFER"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CORPORATE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryCompanyName"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"112 Brannan St"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryAddress2"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="err">//Optional</span><span class="w">
    </span><span class="s2">"beneficiaryCity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryState"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryPostal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"94108"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryLandlineNumber"</span><span class="p">:</span><span class="s2">"+123464542947"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryEmailAddress"</span><span class="p">:</span><span class="s2">"tes@testwyre.com"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryEinTin"</span><span class="p">:</span><span class="s2">"00000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryDobDay"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15"</span><span class="p">,</span><span class="w"> </span><span class="err">//Date</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">Incorporation</span><span class="w">
    </span><span class="s2">"beneficiaryDobMonth"</span><span class="p">:</span><span class="s2">"12"</span><span class="p">,</span><span class="w"> </span><span class="err">//Date</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">Incorporation</span><span class="w">
    </span><span class="s2">"beneficiaryDobYear"</span><span class="p">:</span><span class="s2">"1989"</span><span class="p">,</span><span class="w"> </span><span class="err">//Date</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">Incorporation</span><span class="w">
    </span><span class="s2">"paymentType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"LOCAL_BANK_WIRE"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">LOCAL_BANK_WIRE</span><span class="w">
    </span><span class="s2">"accountType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CHECKING"</span><span class="p">,</span><span class="w"> </span><span class="err">//CHECKING</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">SAVINGS</span><span class="w">
    </span><span class="s2">"accountNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"routingNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"chargeablePM"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>
<p>此终端节点用于创建银行账户。</p>
<h2 id='40011f3c91'>查询收款方式</h2>
<p>此终端节点用于查询收款方式下的银行账户信息。</p>

<p><strong>定义</strong></p>

<p><code>GET</code> https://api.testwyre.com/v2/paymentMethod/:paymentMethodId</p>

<p><br>
<strong>Result Format</strong></p>

<pre class="center-column">
{
    "id": "TestPaymentMethod",
    "owner": "account:ABCDEFG",
    "createdAt": 1230940800000,
    "name": "TEST PAYMENT METHOD",
    "defaultCurrency": "USD",
    "status": "ACTIVE",
    "statusMessage": null,
    "waitingPrompts": [],
    "linkType": "TEST",
    "supportsDeposit": true,
    "nameOnMethod": null,
    "last4Digits": null,
    "brand": null,
    "expirationDisplay": null,
    "countryCode": null,
    "nickname": null,
    "rejectionMessage": null,
    "disabled": false,
    "supportsPayment": true,
    "chargeableCurrencies": [
        "GBP",
        "MXN",
        "HKD",
        "USD",
        "CNY",
        "BRL",
        "EUR",
    ],
    "depositableCurrencies": [
        "USD"
    ],
    "chargeFeeSchedule": null,
    "depositFeeSchedule": null,
    "minCharge": null,
    "maxCharge": null,
    "minDeposit": null,
    "maxDeposit": null,
    "documents": [],
    "srn": "paymentmethod:TestPaymentMethod"
}
</pre>
<h2 id='f285eee79f'>美元付款</h2>
<p>美元付款由我们在当地的银行之一发起，与收入款项国家相对应。需注意美元付款每笔最低限额为5美金。</p>

<p><strong>定义</strong></p>

<p><code>POST</code> https://api.testwyre.com/v2/transfers</p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"dest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"paymentMethodType"</span><span class="p">:</span><span class="s2">"INTERNATIONAL_TRANSFER"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"112 Brannan St"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryAddress2"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="err">//Optional</span><span class="w">
    </span><span class="s2">"beneficiaryCity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryState"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryPostal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"94108"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryPhoneNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+14102239203"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryDobDay"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryDobMonth"</span><span class="p">:</span><span class="s2">"12"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"beneficiaryDobYear"</span><span class="p">:</span><span class="s2">"1989"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"paymentType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"LOCAL_BANK_WIRE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"firstNameOnAccount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Billy-Bob"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lastNameOnAccount"</span><span class="p">:</span><span class="s2">"Jones"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accountNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"routingNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"accountType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CHECKING"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">CHECKING</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">SAVINGS</span><span class="w">
    </span><span class="s2">"bankName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bank of America"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"sourceCurrency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BRL"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"destCurrency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"destAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"USD Personal example"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>美元付款字段</strong></p>

<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>dest</td>
<td>object</td>
</tr>
<tr>
<td>dest.paymentMethodType</td>
<td><code>INTERNATIONAL_TRANSFER</code></td>
</tr>
<tr>
<td>dest.country</td>
<td>US</td>
</tr>
<tr>
<td>dest.currency</td>
<td>USD</td>
</tr>
<tr>
<td>dest.beneficiaryType</td>
<td><code>INDIVIDUAL</code> or <code>CORPORATE</code></td>
</tr>
<tr>
<td>dest.beneficiaryPhoneNumber</td>
<td>个人账户需填写</td>
</tr>
<tr>
<td>dest.beneficiaryLandlineNumber</td>
<td>公司账户需填写</td>
</tr>
<tr>
<td>dest.beneficiaryEinTin</td>
<td>公司账户需填写</td>
</tr>
<tr>
<td>dest.beneficiaryEmailAddress</td>
<td>公司账户需填写</td>
</tr>
<tr>
<td>dest.beneficiaryCompanyName</td>
<td>公司账户需填写</td>
</tr>
<tr>
<td>dest.firstNameOnAccount</td>
<td>法人名（不包括姓）</td>
</tr>
<tr>
<td>dest.lastNameOnAccount</td>
<td>法人姓</td>
</tr>
<tr>
<td>dest.accountNumber</td>
<td>法人银行账号</td>
</tr>
<tr>
<td>dest.routingNumber</td>
<td>法人银行账户 routing number</td>
</tr>
<tr>
<td>dest.accountType</td>
<td><code>CHECKING</code> or <code>SAVINGS</code></td>
</tr>
<tr>
<td>destAmount</td>
<td>存入收方金额,从用户账户减除的款项将自动计算汇率和手续费</td>
</tr>
<tr>
<td>destCurrency</td>
<td>存入收方币种，若汇出存入币种不一致将自动进行兑换</td>
</tr>
<tr>
<td>sourceCurrency</td>
<td>账户原币种</td>
</tr>
</tbody></table>

<p><strong>到账时间</strong></p>

<p>美国银行结算时间为美国中部标准时间下午四点。</p>

<p>若在当日下午四点前提交转账提现请求，当日处理到账，当天下午四点后提交则下一个工作日到账。</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="java">java</a>
                <a href="#" data-language-name="ruby">ruby</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="php">php</a>
                <a href="#" data-language-name="csharp">csharp</a>
                <a href="#" data-language-name="cURL">cURL</a>
                <a href="#" data-language-name="json">json</a>
          </div>
      </div>
    </div>
  </body>
</html>
